var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Excel=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=23)}({23:function(t,e,i){"use strict";i.r(e);var n,o,r,s=function(){function t(){}return t.prototype.u=function(){},t.prototype.shipAssertTag=function(){},t.prototype.debugAssertTag=function(){},t}();(o=n||(n={}))[o.Error=10]="Error",o[o.Warning=15]="Warning",o[o.Info=50]="Info",o[o.Verbose=100]="Verbose",o[o.Spam=200]="Spam",function(t){t[t.h=0]="msoulscat_ES_EWAJS",t[t.v=1]="msoulscat_ES_EWAJSGrid",t[t.g=6]="msoulscat_ES_EWAJSChart",t[t.O=202]="msoulscat_MSOSP_FileMenuCommands",t[t._=301]="msoulscat_Wac_WordViewer",t[t.A=306]="msoulscat_Wac_BrowserGeneral",t[t.P=320]="msoulscat_Wac_TaskPane",t[t.U=339]="msoulscat_Wac_OneNoteGeneral",t[t.R=340]="msoulscat_Wac_Ribbon",t[t.N=379]="msoulscat_Wac_WopiPendingApplication",t[t.F=383]="msoulscat_Wac_Telemetry",t[t.W=391]="msoulscat_Wac_WacCatchUpActivities",t[t.k=394]="msoulscat_Wac_Dictation",t[t.H=395]="msoulscat_Wac_OneNoteSync",t[t.B=700]="msoulscat_Wac_VisioApp",t[t.J=1601]="msoulscat_OneNoteOnline_EditableCache",t[t.j=800]="msoulscat_Wac_PptAnimation",t[t.q=833]="msoulscat_Wac_PptLive",t[t.Z=834]="msoulscat_Wac_PptMWeb",t[t.$=815]="msoulscat_Wac_PptShape",t[t.X=817]="msoulscat_Wac_PptSession",t[t.K=830]="msoulscat_Wac_PptSlideshow",t[t.Y=2300]="msoulscat_Wac_VersionHistory",t[t.tt=302]="msoulscat_Wac_WordPresence",t[t.et=3005]="msoulscat_Wac_WordVersionHistory",t[t.nt=3006]="msoulscat_Wac_LivePersonaCard",t[t.ot=3012]="msoulscat_Wac_CatchUpFlyout"}(r||(r={}));var a;(function(){function t(){}t.tagIntToString=function(e){return e<=t.maxNumericTag?e.toString():e>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e):t.map.charAt(e>>24&63)+t.map.charAt(e>>18&63)+t.map.charAt(e>>12&63)+t.map.charAt(e>>6&63)+t.map.charAt(63&e)},t.getLogMessage=function(e,i,n){return"tag_"+t.tagIntToString(e)+" ["+r[i]+"] "+n},t.prototype.u=function(e,i,o,r){var s=this.logMessage;switch(o){case n.Error:s=this.logError;break;case n.Warning:s=this.logWarning;break;case n.Info:s=this.logInfo;break;case n.Verbose:s=this.logVerbose;break;case n.Spam:default:s=this.logMessage}try{s(t.getLogMessage(e,i,r))}catch(t){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw t}},t.prototype.shipAssertTag=function(e,i,n,o){console.assert(n,t.getLogMessage(e,i,o))},t.prototype.debugAssertTag=function(t,e,i,n){this.shipAssertTag(t,e,i,n)},t.prototype.logMessage=function(t){"log"in console&&console.log(t)},t.prototype.logError=function(t){"error"in console&&console.error(t)},t.prototype.logWarning=function(t){"warn"in console&&console.warn(t)},t.prototype.logInfo=function(t){"info"in console&&console.info(t)},t.prototype.logVerbose=function(t){"debug"in console&&console.debug(t)},t.maxNumericTag=65535,t.minOldSchemeHighByteValue=36,t.map="abcdefghijklmnopqrstuvwxyz0123456789"})(),new(function(){function t(){this.externalLogger=new s}return t.prototype.setLogger=function(t){this.externalLogger=t},t.prototype.u=function(t,e,i,n){this.externalLogger.u(t,e,i,n)},t.prototype.debugAssertTag=function(t,e,i,n){this.externalLogger.debugAssertTag(t,e,i,n)},t.prototype.shipAssertTag=function(t,e,i,n){this.externalLogger.shipAssertTag(t,e,i,n)},t}());function c(t,e,i){if(""!==e)if(navigator&&navigator.sendBeacon)navigator.sendBeacon(e,t);else{var n=new XMLHttpRequest;n.readyState!==XMLHttpRequest.UNSENT&&n.readyState!==XMLHttpRequest.DONE||(n.open("POST",e,i),n.send(t))}}function u(t,e,i,n){var o=t.map((function(t){return function(t,e){var i={};i.G=t.tag,i.T=t.timestamp-e,i.M=t.message,i.C=t.category;var n=1e3*t.type+t.level;return i.D=n,i}(t,n)})),r=function(t,e,i,n){var o={};return o.T=t,o.L=e,o.S=i,o.I=n,o.V=1,o}(n,o,e,i);return JSON.stringify(r)}!function(t){t[t.Trace=0]="Trace",t[t.Assert=1]="Assert"}(a||(a={}));!function(){function t(e,i){var n=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){n.triggerUpload(!1,!1)},this.flush=function(){n.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return n.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(e,i){(window.clearTimeout(n.timeoutId),n.logCache.length>0)&&(n.uploadId+=1,c(u(n.logCache,n.userSessionId,n.uploadId,n.timestampBase),n.remoteUrlEndpoint,i),n.logCache=[],n.timestampBase=Date.now());e&&(n.timeoutId=window.setTimeout(n.triggerUploadAsync,t.uploadCadenceInMsSec))},this.userSessionId=e,this.remoteUrlEndpoint=i+"?usid="+e,window.setTimeout((function(){return n.triggerUpload(!0,!0)}),0)}t.prototype.handleTrace=function(e){e.message.length>t.messageMaxChars&&(e.message=e.message.substr(0,t.messageMaxChars-t.trimmedMessage.length)+t.trimmedMessage),this.logCache.push(e),(this.logCache.length>t.uploadTriggerSize||e.level===n.Error)&&this.triggerUploadAsync()},t.messageMaxChars=3072,t.uploadCadenceInMsSec=3e4,t.uploadTriggerSize=30,t.trimmedMessage="... [Trimmed]"}();n.Info;var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var h=function(){return(h=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var d;!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}(function(t,e){function i(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})(e,t)}(s);function l(){if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;if(t.indexOf("Firefox")>-1)return d.Firefox;if(t.indexOf("Opera")>-1)return d.Opera;if(t.indexOf("Trident")>-1)return d.IE;if(t.indexOf("Edge")>-1)return d.Edge;if(t.indexOf("Chrome")>-1)return d.Chrome;if(t.indexOf("Safari")>-1)return d.Safari}return d.Unknown}function p(){"undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}})}function v(){try{return navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("Macintosh")>=0&&I()&&!(navigator.userAgent.indexOf("iPhone")>=0)||navigator.userAgent.indexOf("Android")>=0||I()}catch(t){return!1}}function m(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(t){return!1}}function w(){return l()===d.IE&&!function(){if(l()!==d.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function g(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(t){return!1}}function I(){return navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}!function(t){t[t.Firefox=0]="Firefox",t[t.Opera=1]="Opera",t[t.IE=2]="IE",t[t.Edge=3]="Edge",t[t.Chrome=4]="Chrome",t[t.Safari=5]="Safari",t[t.Unknown=6]="Unknown"}(d||(d={}));function S(t){return 8===t.toLowerCase().indexOf("ffc")}function b(t){return 8===t.toLowerCase().indexOf("ppc")}function C(t){var e=t.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return e&&e[1]?e[1]:"public"}function y(t){var e=t.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}function O(t,e){var i=t.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!i)throw new Error("Invalid URL");var n=i[2];if(void 0===e)return n;if(e<0)throw new Error("subDomainParts should be at least 1");return n.split(".").slice(-(e+1)).join(".")}function _(t){return t+"RemoteUls.ashx"}function T(t,e,i){i&&(t[e.toLowerCase()]=i)}function A(t,e){var i=t.indexOf("&"+e+"=");if(-1===i&&(i=t.indexOf("?"+e+"=")),-1===i)return"";var n=i+(e.length+2),o=t.indexOf("&",n);return t.substring(n,-1===o?void 0:o)}function E(t,e,i,n){if(void 0===n&&(n=!1),!i)return t;var o=t,r=o.indexOf("?"),s="&";r===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?s="":-1===r&&(s="?");var a=e.toLowerCase()+"=",c=o.toLowerCase().indexOf(a,r);if("?"!==s&&c>=0){if(n){var u=o.indexOf("&",c);o=o.substring(0,c)+a+i+(-1===u?"":o.substring(u))}return o}return o.concat(s,a,i)}function P(t){var e={},i=t.indexOf("?");return-1===i||i===t.length-1||t.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(t){if(t){var i=t.indexOf("=");-1!==i&&i!==t.length-1&&(e[t.substring(0,i).toLowerCase()]=t.substring(i+1))}})),e}function U(t){if(!t)return"";var e=-1===t.indexOf("#")?t.length:t.indexOf("#"),i=t.lastIndexOf("/",e);if(-1!==i&&i+1===t.indexOf("://")+"://".length)return"";i+=1;var n=t.indexOf("?");if(-1!==(n=n>=e?-1:n)&&i>n)return"";var o=-1===n?e:n;return i>=o?"":t.substring(i,o)}function R(t){var e=new RegExp("(c[1-5])h?(-)");return t.replace(e,"$1h$2")}function N(t){return/[?&]new=1\b/i.test(t)}function x(t,e){return{shouldPreload:function(e){return t(e)},preload:function(t,i,o,s){e(t,i,s).forEach((function(t){!function(t,e,i,o){var s=document.createElement("link");if(s.setAttribute("crossorigin","anonymous"),s.rel=W,s.href=t,e){var a=i||U(t);e.ULS.u(592315601,r.N,n.Info,"Preloading resource: "+a);s.addEventListener("error",(function(){e.ULS.u(592479445,r.N,n.Error,"Resource failed to load: "+a)}))}s.setAttribute("as","script"),document.head.appendChild(s),o&&s.addEventListener("load",o,{once:!0})}(t,o)}))}}}var F,W=(F=l())===d.Firefox||F===d.IE?"prefetch":"preload";var k,M={en:"1033",cs:"1029",da:"1030",de:"1031",el:"1032",fi:"1035",fr:"1036",hu:"1038",it:"1040",ja:"1041",ko:"1042",nl:"1043",nb:"1044",sk:"1051",sv:"1053",tr:"1055",uk:"1058",sl:"1060",es:"3082",pl:"1045",ro:"1048",ru:"1049"};!function(t){t.Unknown="UNKNOWN",t.Initialized="INITIALIZED",t.Prebooted="PREBOOTED",t.Booting="BOOTING",t.Booted="BOOTED",t.Failed="FAILED",t.Disposing="DISPOSING",t.Disposed="DISPOSED"}(k||(k={}));var D,H=function(){try{var t=window.performance;return t&&t.now&&t.now()!==1/0}catch(t){return!1}}();function B(){return H?window.performance.now():Date.now()}function J(){if(!D){var t=window.performance;D=H&&t.timing&&t.timing.navigationStart?function(){return Math.round(t.now()+t.timing.navigationStart)}:Date.now?Date.now:function(){return(new Date).getTime()}}return D()}var L,j,V=function(){function t(t){var e=this;this.rt=3e4,this.st=30,this.at=0,this.ct=[],this.ut=J(),this.ft="",this.ht=0,this.flushOnClose=function(){e.dt(!1,!1)},this.flush=function(){e.lt()},this.lt=function(){window.setTimeout((function(){return e.dt(!0,!0)}),0)},this.dt=function(t,i){var n=B();if(window.clearTimeout(e.pt),e.vt){if(e.ct.length>0)e.at+=1,c(u(e.ct.splice(0,t?e.st:e.ct.length),e.ft,e.at,e.ut),e.vt,i),e.ut=J();t&&(e.pt=window.setTimeout(e.lt,e.ct.length>e.st?1e3:e.rt)),e.ht+=B()-n}},t&&this.configure(t)}return t.prototype.getTimeSpentLogging=function(){return this.ht},t.prototype.addLoggingTime=function(t){this.ht+=t},t.prototype.configure=function(t){var e=this,i=B();if(t.uploadCadenceInMs&&(this.rt=t.uploadCadenceInMs),t.uploadTriggerSize&&(this.st=t.uploadTriggerSize),t.sessionId&&(this.ft=t.sessionId),t.remoteUlsEndpoint){if(!t.sessionId&&this.vt)throw new Error("Remote ULS endpoint is already set");this.vt=t.remoteUlsEndpoint+"?usid="+this.ft,this.ut=J(),window.setTimeout((function(){return e.dt(!0,!0)}),0)}this.ht+=B()-i},t.prototype.handleTrace=function(t){var e=B();t.message.length>3072&&(t.message=t.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.ct.push(t),(this.ct.length>this.st||t.level===n.Error)&&this.lt(),this.ht+=B()-e},t}(),z=[];!function(t){t.wt="BootstrapperMaxUlsHeartbeatTime",t.gt="BootstrapperNoCompleteWarning1Time",t.It="BootstrapperNoCompleteWarning2Time",t.St="RemoteUlsETag",t.bt="RemoteUlsSuppressions",t.Ct="BootstrapperSettingsFetchPeriod",t.yt="timestamp",t.Ot="BootstrapperUlsHeartbeatIntervalMs",t._t="BootstrapperUlsHeartBeatIsEnabled",t.Tt="BootstrapperUlsUploadCadenceMs",t.At="WordConsumptionViewToEditRedirectIsEnabled"}(j||(j={}));function G(t){var e=new V(t);function i(t,i,n,o){var r=B();if(!function(t){return 1===z[t]}(t)){var s={timestamp:J(),category:i,tag:t,level:n,type:a.Trace,message:o};e.addLoggingTime(B()-r),e.handleTrace(s)}}return{ULS:{u:function(t,e,n,o){i(t,e,n,o)},shipAssertTag:function(t,e,o,r){o&&i(t,e,n.Error,r)},debugAssertTag:function(t,e,i,n){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:e.flush,flushOnClose:e.flushOnClose},configure:function(t){e.configure(t)},settingsChangeHandler:function(t){var i,n;i=t.Et.getValue(j.bt,""),n=t.Et.getValue(j.St,""),L&&n===L||(z=[],L=n,i&&i.split(",").forEach((function(t){var e=parseInt(t,10);e&&(z[e]=1)}))),e.configure({uploadCadenceInMs:t.Et.getValue(j.Tt,6e4)})},getTimeSpentLogging:function(){return e.getTimeSpentLogging()}}}var q= "16.0.13517.35052";function Z(){return q}var $,X,K;function Q(){return function(t){if(!t)throw new Error("Build number not available");var e=t.split(".");if(4!==e.length)throw new Error("Build number has incorrect format");return e[0]+e[2]+e[3]}(Z())}function Y(t){return JSON.stringify(t,Object.getOwnPropertyNames(t))}function tt(t,e){try{if(void 0===window.performance)return void e.ULS.u(595948609,r.N,n.Info,"Performance not supported");var i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void e.ULS.u(595948610,r.N,n.Info,"No resources under performance");for(var o=new RegExp(t+"(-boot.min|(.(app|preview))?.boot).js","i"),s=i.length-1;s>=0;s-=1){var a=i[s],c=a.name.match(o);if(c){var u=JSON.stringify(a);return u=u.replace(new RegExp(a.name,"g"),c[0]),void e.ULS.u(595948616,r.N,n.Info,u)}}e.ULS.u(595948484,r.N,n.Info,"Could not find JSAPI resource timing entry")}catch(t){e.ULS.u(595948617,r.N,n.Info,"Could not trace the resource timing: "+Y(t))}}function et(t){var e=h(h({},t.host),{sessionId:t.hostSessionId,domain:location?location.host:void 0}),i={};if(t.wdParams){var n=JSON.parse(JSON.stringify(t.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(t){n[t]&&(i[t]=n[t])}))}var o=h({},t.rebootOverride);delete o.ackExpected,delete o["ui-language"],delete o.wdUserSession,delete o.rebootMode,delete o.documentUrl;var r=t.wopi;return{accessToken:r?{length:r.accessToken.length,expiry:r.expiry}:"N/A",bootParams:t.bootParams,build:Z(),host:e,intent:t.intent,jsApiVersion:"v2",rebootOverride:o,region:C(t.appBaseUrl),sessionOrigin:t.hostInitDiagnostics?t.hostInitDiagnostics.entryPoint:void 0,sessionContext:t.sessionContext,throttling:t.throttling,ui:t.ui,viewMode:t.viewMode,wdParams:i}}function it(){var t={perfNowSupported:H,browser:d[l()],touchMode:v(),highContrast:m(),windows10x:g()};try{var e=window.navigator,i=e.connection||e.mozConnection||e.webkitConnection;i&&(t.netDownlink=i.downlink,t.netDownlinkMax=i.downlinkMax,t.netEffectiveType=i.effectiveType,t.netRtt=i.rtt,t.netSaveData=i.saveData,t.netType=i.type),t.deviceMemory=e.deviceMemory,t.logicalProcessors=e.hardwareConcurrency}catch(t){}return t}function nt(t,e,i){t.ULS.u(595957843,r.N,n.Info,"Page lifecycle: "+e+" fired"+(i?", flushing logger":"")),i&&t.ULS.flush()}function ot(t,e){$=function(){return nt(t,"OnBeforeUnload",e)},X=function(){return nt(t,"OnPageHide",e)},K=function(){return nt(t,"VisibilityChange_"+document.visibilityState,e)},window.addEventListener("beforeunload",$,{capture:!0,once:!0}),window.addEventListener("pagehide",X,{capture:!0}),window.addEventListener("visibilitychange",K,{capture:!0})}function rt(){window.removeEventListener("beforeunload",$,{capture:!0}),window.removeEventListener("pagehide",X,{capture:!0}),window.removeEventListener("visibilitychange",K,{capture:!0})}var st,at;function ct(t,e,i,o){if(e.getValue(j._t,!1)){st=B();var s=t?3e3:5e3;at=window.setInterval((function(){i.ULS.u(595724178,r.N,n.Info,"Boot_HeartBeat"),B()-st>e.getValue(j.wt,3e5)&&(ut(),o&&o())}),e.getValue(j.Ot,s))}}function ut(){at&&(window.clearInterval(at),at=void 0)}var ft;function ht(t,e){t.ULS.u(594901218,r.N,n.Warning,"Boot_NotComplete_"+(e||"Final")),t.ULS.flush()}function dt(t){for(var e=0;e<t.length;e+=1)t[e]&&window.clearTimeout(t[e])}function lt(t,e){return{isFeatureEnabled:function(i){return function(t,e,i){if(!e)return;try{return e(t)}catch(t){i&&i.ULS.u(594883024,r.N,n.Error,"IsFeatureEnabled callback error: "+Y(t))}return}(i,t,e)}}}function pt(t,e){var i={};if(Object.keys(ft).forEach((function(e){var n=t.isFeatureEnabled(ft[e]);void 0!==n&&(i[ft[e]]=n?"1":"0")})),e&&e.wdFlights)for(var n=0,o=e.wdFlights.toLowerCase().split(",");n<o.length;n++){var r=o[n];"et-treatment"!==r&&"et-control"!==r||(i[ft.Pt]="et-treatment"===r?"1":"0")}return JSON.stringify(i)}!function(t){t.Pt="EnterpriseTemplates",t.Ut="ExcelAdaptiveLayoutDownload",t.Rt="ExcelJsApiV2",t.Nt="ExcelJsApiV2NoWrapper",t.xt="ExcelLandingPageOfflineTelemetry",t.Ft="ExcelLandingPageObserverRetry",t.Wt="H2StaticContent",t.kt="HashedUrl",t.Mt="ODCShareLinkPreload",t.Dt="OfficeComExcelJsApiV2",t.Ht="OfficeComUiHost",t.Bt="OfficeComWordJsApiV2",t.Jt="OfficeHwaUiHost",t.Lt="WordJsApiV2",t.jt="WordJsApiV2NoWrapper",t.Vt="WordViewToUnifiedRead"}(ft||(ft={}));var vt,mt,wt,gt,It,St,bt=function(){function t(){this.zt=[]}return t.prototype.add=function(t){t&&this.zt.push(t)},t.prototype.remove=function(t){if(t){var e=this.zt.indexOf(t);e>-1&&this.zt.splice(e,1)}},t.prototype.removeAll=function(){this.zt=[]},t.prototype.dispatch=function(t,e){this.zt.forEach((function(i){try{i(t)}catch(t){e&&e(t)}}))},t}(),Ct=function(){function t(t,e){var i=this;this.Gt=0,this.qt=function(){if(i.Zt){var t=new XMLHttpRequest;t.open("GET",i.Zt),t.responseType="json",t.timeout=5e3,t.send(),t.onload=function(){if(200===t.status&&t.response?(i.setSettingsOnIdle(t.response),i.Gt=0):(i.$t.ULS.u(592836771,r.N,n.Error,"Fetch settings error. Status: "+t.status+", curErrors: "+i.Gt),i.Gt+=1),!(i.Gt>7)){var e=i.getValue(j.Ct,3e5);i.Gt>3&&(e+=(i.Gt-3+1)*(e/2)),i.Xt=window.setTimeout(i.qt,e)}}}},this.Kt=t,this.Qt="Prod"+t+"Settings",this.$t=e,this.Yt=new bt,this.getCurrentSettings()}return t.prototype.initializePeriodicFetch=function(t,e){this.Qt=(S(t)?"FF":"Prod")+this.Kt+"Settings",this.getCurrentSettings(),this.Zt=t+"AppSettingsHandler.ashx?app="+this.Kt+"&usid="+e+"&build="+Z(),this.Xt||(this.Xt=window.setTimeout(this.qt,3e4))},t.prototype.getValue=function(t,e){if(this.te||this.getCurrentSettings(),!this.te||!this.te.hasOwnProperty(t))return e;var i=this.te[t],n=typeof e;if(typeof i===n)return i;if("string"==typeof i){if("number"===n)return parseInt(i,10);if("boolean"===n)return"true"===i}return e},t.prototype.addSettingsChangeListener=function(t){this.Yt.add(t)},t.prototype.removeSettingsChangeListener=function(t){this.Yt.remove(t)},t.prototype.dispose=function(){this.Xt&&window.clearTimeout(this.Xt),this.ee&&self.cancelIdleCallback(this.ee),this.Xt=void 0,this.ee=void 0,this.te=void 0,this.Yt.removeAll()},t.prototype.getCurrentSettings=function(){try{if(!window||!window.localStorage)return;var t=window.localStorage.getItem(this.Qt);if(!t)return;var e=JSON.parse(t);this.updateCurrentSettings(e)}catch(t){this.$t.ULS.u(592836768,r.N,n.Warning,"Failed to get settings from localStorage: "+Y(t))}},t.prototype.updateCurrentSettings=function(t){var e=this;return!!this.isValidSettings(t)&&(this.te=t,this.Yt.dispatch({Et:this},(function(t){e.$t.ULS.u(592836769,r.N,n.Error,"Settings listener error: "+Y(t))})),!0)},t.prototype.isValidSettings=function(t){if(t&&"object"==typeof t){if(t.hasOwnProperty(j.yt)&&!isNaN(t.timestamp))return!0;this.$t.ULS.u(592836770,r.N,n.Error,"Received invalid settings")}return!1},t.prototype.setSettingsOnIdle=function(t){var e=this;"requestIdleCallback"in window?(this.ee&&self.cancelIdleCallback(this.ee),this.ee=window.requestIdleCallback((function(){return e.setSettings(t)}),{timeout:1e4})):window.setTimeout((function(){return e.setSettings(t)}),0)},t.prototype.setSettings=function(t){if(this.updateCurrentSettings(t)&&window&&window.localStorage){var e=JSON.stringify(t);try{window.localStorage.setItem(this.Qt,e)}catch(t){this.$t.ULS.u(592836800,r.N,n.Warning,"Failed to set localStorage: "+Y(t))}}},t}();!function(t){t.accessToken="accessToken",t.appReboot="appReboot",t.authToken="authToken",t.boot="boot",t.closeTab="closeTab",t.customAuthConfig="customAuthConfig",t.createNew="createNew",t.dispose="dispose",t.fileEmbed="fileEmbed",t.frameTrust="frameTrust",t.handleBootState="handleBootState",t.postMessage="postMessage",t.refreshSessionInfo="refreshSessionInfo",t.rename="rename",t.setOverlayContent="setOverlayContent",t.switchMode="switchMode",t.userAccessAndPermissions="userAccessAndPermissions",t.wopiInfoFromUrl="wopiInfoFromUrl"}(vt||(vt={})),function(t){t.blurFocus="blurFocus",t.boot="boot",t.completeCreateNew="completeCreateNew",t.continueAccessibilityLoop="continueAccessibilityLoop",t.createNew="createNew",t.dispose="dispose",t.grabFocus="grabFocus",t.popState="popState",t.rename="rename",t.sendAccessToken="sendAccessToken",t.sendAuthToken="sendAuthToken",t.sendCustomAuthConfig="sendCustomAuthConfig",t.sendEmbeddedViewUrl="sendEmbeddedViewUrl",t.sendSessionInfo="sendSessionInfo",t.sendUserAccessAndPermissions="sendUserAccessAndPermissions",t.sendWopiInfo="sendWopiInfo",t.switchMode="switchMode"}(mt||(mt={})),function(t){t.ie="App_AccessibilityLoopComplete",t.ne="WacInitialize_Ready",t.oe="Wac_AppFailed",t.re="Wac_AppBootState",t.se="Wac_AppCompleted",t.ae="BrowserEvent",t.ce="UI_Close",t.ue="App_CloseTab",t.fe="UI_Conversation",t.he="UI_CopyAndEdit",t.le="App_CreateNewDocument",t.pe="Wac_AppDataSavedStatus",t.ve="UI_Download",t.me="UI_Edit",t.we="Error",t.ge="UI_FileEmbed",t.Ie="UI_FileProperties",t.Se="File_Rename",t.be="File_RenameFailed",t.Ce="UI_FileVersions",t.ye="StateChanged",t.Oe="App_IsFrameTrusted",t._e="GetAccessToken",t.Te="App_GetAuthToken",t.Ae="App_GetCustomAuthConfig",t.Ee="App_WopiInfoFromUrl",t.Pe="App_LoadingStatus",t.Ue="App_SwitchMode",t.Re="UI_OpenInBrowser",t.Ne="UI_OpenInClient",t.xe="PageChanged",t.Fe="App_PushCommentContext",t.We="App_PushState",t.ke="App_DocReboot",t.Me="UI_RedeemForCommenting",t.De="App_RefreshSessionInfo",t.He="UI_ReplyWithChanges",t.Be="UI_ReportAbuse",t.Je="UI_SaveStatus",t.Le="WopiSession_Complete_Ack",t.je="SetOverlayContent",t.Ve="UI_Sharing",t.ze="UI_ShareForm",t.Ge="UI_SignIn",t.qe="App_Unloaded",t.Ze="Wac_UnloadingApp",t.$e="PageCount",t.Xe="UI_CheckUserAccessAndGrantPermissions",t.Ke="User_Activity",t.Qe="Edit_Notification",t.Ye="UI_Workflow",t.ti="ZoomChanged"}(wt||(wt={})),function(t){t.ei="Ack",t.ii="WacInitialize_Ready_Ack",t.ni="Wac_BeforeUnloadApp",t.oi="Blur_Focus",t.ri="Wac_AppFailed_Ack",t.si="Wac_AppCompleted_Ack",t.ai="WopiStartSession_Complete",t.ci="WopiPendingSession_Complete",t.hi="Host_AccessibilityLoopComplete",t.Oe="Host_IsFrameTrusted",t.di="Grab_Focus",t.li="HostCacheDiagnostic",t.pi="JsApiDiagnostics",t.vi="PageChanged_Ack",t.mi="App_PopState",t.wi="Host_PostmessageReady",t.gi="File_Rename",t.Ii="PostAccessToken",t.Si="Host_SetAuthToken",t.bi="Host_SetCustomAuthConfig",t.Ci="App_PushCommentContext",t.yi="CanEmbed",t.Oi="Host_RefreshSessionInfo",t._i="CheckUserAccessAndGrantPermissions_Result",t.Ti="Host_WopiInfoFromUrl",t.Ai="SetCurrentPage",t.Ei="SetZoomLevel",t.Pi="WopiPendingSession_Fail",t.Ui="SetOverlayContent",t.Ri="WopiPendingApplicationComplete_Received",t.Ni="Host_SwitchMode",t.xi="Host_Unload",t.Fi="PageCount_Ack",t.Wi="ZoomChanged_Ack"}(gt||(gt={})),function(t){t.AccessibilityLoopCompleted="AccessibilityLoopCompleted",t.BootCompleted="BootCompleted",t.BrowserEvent="BrowserEvent",t.Close="Close",t.Conversation="Conversation",t.CopyAndEdit="CopyAndEdit",t.CreateNewDocument="CreateNewDocument",t.Disposed="Disposed",t.Download="Download",t.Edit="Edit",t.Error="Error",t.FileEmbed="FileEmbed",t.FileProperties="FileProperties",t.FileRenamed="FileRenamed",t.FileVersions="FileVersions",t.FrameStateChanged="FrameStateChanged",t.GetAccessToken="GetAccessToken",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.GetWopiInfoFromUrl="GetWopiInfoFromUrl",t.ModeSwitched="ModeSwitched",t.OpenInBrowser="OpenInBrowser",t.OpenInClient="OpenInClient",t.PageChanged="PageChanged",t.PushState="PushState",t.Reboot="Reboot",t.RedeemForCommenting="RedeemForCommenting",t.RefreshSessionInfo="RefreshSessionInfo",t.ReplyWithChanges="ReplyWithChanges",t.ReportAbuse="ReportAbuse",t.SaveStatus="SaveStatus",t.Share="Share",t.ShareForm="ShareForm",t.SignIn="SignIn",t.UserAccessAndPermissions="UserAccessAndPermissions",t.UserActivity="UserActivity",t.UserEditActivity="UserEditActivity",t.Workflow="Workflow",t.ZoomChanged="ZoomChanged"}(It||(It={}));var yt=((St={})[mt.boot]={ki:vt.boot},St[mt.createNew]={ki:vt.createNew},St[mt.dispose]={ki:vt.dispose},St[mt.rename]={ki:vt.rename},St[mt.switchMode]={ki:vt.switchMode},St[wt.re]={ki:vt.handleBootState},St[wt.ue]={ki:vt.closeTab},St[wt.Oe]={ki:vt.frameTrust},St[wt.ge]={ki:vt.fileEmbed},St[wt._e]={ki:vt.accessToken},St[wt.Te]={ki:vt.authToken},St[wt.Ae]={ki:vt.customAuthConfig},St[wt.Ee]={ki:vt.wopiInfoFromUrl},St[wt.ke]={ki:vt.appReboot},St[wt.De]={ki:vt.refreshSessionInfo},St[wt.je]={ki:vt.setOverlayContent},St[wt.Xe]={ki:vt.userAccessAndPermissions},St[mt.blurFocus]={Mi:gt.oi},St[mt.continueAccessibilityLoop]={Mi:gt.hi},St[mt.grabFocus]={Mi:gt.di},St[mt.popState]={Mi:gt.mi},St[wt.ie]={Di:It.AccessibilityLoopCompleted},St[wt.ae]={Di:It.BrowserEvent},St[wt.ce]={Di:It.Close},St[wt.fe]={Di:It.Conversation},St[wt.he]={Di:It.CopyAndEdit},St[wt.le]={Di:It.CreateNewDocument},St[wt.ve]={Di:It.Download},St[wt.me]={Di:It.Edit},St[wt.we]={Di:It.Error},St[wt.Ie]={Di:It.FileProperties},St[wt.Se]={Di:It.FileRenamed},St[wt.Ce]={Di:It.FileVersions},St[wt.ye]={Di:It.FrameStateChanged},St[wt.Ue]={Di:It.ModeSwitched},St[wt.Re]={Di:It.OpenInBrowser},St[wt.Ne]={Di:It.OpenInClient},St[wt.xe]={Di:It.PageChanged},St[wt.We]={Di:It.PushState},St[wt.Me]={Di:It.RedeemForCommenting},St[wt.He]={Di:It.ReplyWithChanges},St[wt.Be]={Di:It.ReportAbuse},St[wt.Je]={Di:It.SaveStatus},St[wt.Ve]={Di:It.Share},St[wt.ze]={Di:It.ShareForm},St[wt.Ge]={Di:It.SignIn},St[wt.Ke]={Di:It.UserActivity},St[wt.Qe]={Di:It.UserEditActivity},St[wt.Ye]={Di:It.Workflow},St[wt.ti]={Di:It.ZoomChanged},St);function Ot(){var t=new Uint8Array(31),e=function(t){var e={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){e.crypto=!0;try{return i.getRandomValues(t),e}catch(t){e.exceptions.push("crypto: "+Y(t))}}e.perfNow=H;for(var n=0;n<t.length;n+=1){try{if(H){var o=Math.floor(100*window.performance.now())%10;(o<0||o>9)&&(o=0);for(var r=0;r<o;r+=1)Math.random()}}catch(t){e.exceptions.push("Math.random: "+Y(t))}t[n]=Math.floor(16*Math.random())}return e}(t),i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=15&t[i];return i+=1,("x"===e?n:3&n|8).toString(16)})),e]}var _t=function(){function t(t,e,i,o,s,a,c){var u,f=this;this.pendingReboot=!1,this.skipWopiValidation=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.Hi={},this.onMessage=function(t){var e=t.MessageId,i=t.Values||{},o=f.Hi[e];if(o&&o.length>0)f.dispatchAction(e,i);else{var s=yt[e];if(s){var a=s.ki,c=s.Di;a?f.Bi[a](e,i,f,f.Ji[a]).catch((function(t){f.logger.ULS.u(593364502,r.N,n.Error,a+" flow error: "+Y(t))})):c&&f.raiseEvent(c,i)}}},this.state=k.Unknown;var h=Ot(),d=h[0],l=h[1];this.logger=G(),this.logger.ULS.u(593506837,r.N,n.Info,JSON.stringify(l)),this.sessionId=d,this.hostSessionId=i.hostSessionId,this.host=t.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=t.user,this.bootstrapperUrl=t.bootstrapperUrl,this.ui=t.ui,this.viewMode=t.viewMode,this.application=o,this.appInfo=e,this.session=s,this.featureManager=lt(t.host.capabilities&&t.host.capabilities.isFeatureEnabledCallback,this.logger),this.Et=new Ct(e.name,this.logger),this.preloader=e.preloader,u=a(this.featureManager),this.Bi=u[0],this.Ji=u[1],this.Li=c,this.Et.addSettingsChangeListener(this.logger.settingsChangeHandler)}return Object.defineProperty(t.prototype,"diagnostics",{get:function(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}},enumerable:!0,configurable:!0}),t.prototype.raiseEvent=function(t,e){try{this.Li(t,e)}catch(t){this.logger.ULS.u(593506838,r.N,n.Error,"Event handler error: "+Y(t))}},t.prototype.addActionHandler=function(t,e){this.Hi[t]||(this.Hi[t]=[]),this.Hi[t].push(e)},t.prototype.removeActionHandler=function(t,e){var i=this.Hi[t];if(i&&i.length>0){var n=i.indexOf(e);n>-1&&i.splice(n,1)}},t.prototype.run=function(t,e,i){var o=this,s=[],a=this.Hi[t];if(a&&a.length>0)s.push(this.dispatchAction(t,e));else{var c=yt[t];if(c){var u=c.ki,f=c.Mi;if(u){var h=(0,this.Bi[u])(t,e,this,this.Ji[u],i).catch((function(t){return o.logger.ULS.u(593364501,r.N,n.Error,u+" flow error: "+Y(t)),{completion:"failure",error:t}}));s.push(h)}else f&&(this.shouldUseContainer()?this.container&&this.container.postMessage(f,e):this.Bi[vt.postMessage](t,e,this,void 0),s.push(Promise.resolve({completion:"success"})))}else s.push(Promise.resolve({completion:"failure"})),this.logger.ULS.u(593500189,r.N,n.Warning,"Unhandled command: "+t)}return Promise.race(s)},t.prototype.dispose=function(){if(this.Et.dispose(),this.Hi={},!this.pendingReboot){var t=this.application.sessions,e=t.indexOf(this.session);e&&t.splice(e,1)}},t.prototype.shouldUseContainer=function(){var t=!1;return"Word"===this.appInfo.name?t=this.featureManager.isFeatureEnabled(ft.jt)||this.featureManager.isFeatureEnabled(ft.Bt):"Excel"===this.appInfo.name&&(t=this.featureManager.isFeatureEnabled(ft.Nt)||this.featureManager.isFeatureEnabled(ft.Dt)),t},t.prototype.dispatchAction=function(t,e){var i=this;return this.Hi[t].map((function(o){try{o(t,e)}catch(e){i.logger.ULS.u(593773709,r.N,n.Error,t+" action handler error: "+Y(e))}})),Promise.resolve({completion:"success"})},t}();var Tt,At=function(){function t(t,e,i,n,o,r){var s=this;!function(t){if(void 0===t)throw new TypeError("SessionInitParams");if(void 0===t.hostSessionId)throw new TypeError("HostSessionId")}(i);this.ji=new _t(t,e,i,n,this,r,(function(t,e){return o({type:t,data:e,session:s})})),this.ji.state=k.Initialized}return Object.defineProperty(t.prototype,"id",{get:function(){return this.ji.sessionId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diagnostics",{get:function(){return this.ji.diagnostics},enumerable:!0,configurable:!0}),t.prototype.run=function(t,e,i){return this.ji.run(t,e,i)},t.prototype.boot=function(t,e){return this.ji.run(mt.boot,t,e)},t.prototype.dispose=function(t){return this.ji.run(mt.dispose,void 0,t)},t}(),Et=function(){function t(t,e,i){var o=this;this.Vi="",this.zi="",this.Gi=!1,this.qi=!1,this.Zi=!1,this.$i=function(t){var e=!1,i=!0,s="",a=!1;if(o.Xi&&(e=!0,i=t.source===o.Xi),t.origin&&(a=(s=O(t.origin,2).toLowerCase())===o.zi),!o.Gi&&(!o.qi||a&&i)||o.$t.ULS.u(593232850,r.N,n.Info,"Window: available["+e+"] valid["+i+"]; Origin: valid["+a+"] expected["+o.zi+"] actual["+s+"]"),a&&(!o.Zi||i)){var c;try{c=JSON.parse(t.data)}catch(t){return void o.$t.ULS.u(593232851,r.N,n.Info,"Failed to parse event data: "+Y(t))}var u=c.MessageId;if(u)if(o.$t.ULS.u(593232854,r.N,n.Info,"Received message: "+u+", correlation: "+c.CorrelationId),u!==wt.se&&u!==wt.Pe||o.setTargetOrigin(t.origin),c.Values&&c.Values.ackExpected&&(o.$t.ULS.u(593232855,r.N,n.Info,"Sending Ack back"),o.postMessage(gt.ei,void 0,c.CorrelationId)),o.Ki){o.$t.ULS.u(593232856,r.N,n.Info,"Processing message: "+u);try{o.Ki(c)}catch(t){o.$t.ULS.u(594556386,r.N,n.Error,"Message handler error: "+Y(t))}}else o.$t.ULS.u(591933923,r.N,n.Error,"No message handler");else(o.Gi||o.qi)&&o.$t.ULS.u(593232853,r.N,n.Info,"Missing message id")}},this.$t=e,this.setTargetOrigin(t),i&&this.setMessageHandler(i),window.addEventListener("message",this.$i,!1)}return t.prototype.setTargetOrigin=function(t){var e=y(t).toLowerCase();this.Vi&&this.Vi!==e&&this.$t.ULS.u(593232847,r.N,n.Warning,"Updating origin: ["+this.Vi+"]->["+e+"]"),this.Vi=e,this.zi=O(e,2),this.Gi=S(e),this.qi=b(e)},t.prototype.setTargetWindow=function(t,e){void 0===e&&(e=!1),this.Xi=t,this.Zi=e},t.prototype.setMessageHandler=function(t){this.Ki=t},t.prototype.removeMessageHandler=function(){this.Ki=void 0},t.prototype.postMessage=function(t,e,i){if(this.Xi){this.$t.ULS.u(593232849,r.N,n.Info,"Sending message: "+t);var o={MessageId:t,SendTime:J(),CorrelationId:i,Values:e};this.Xi.postMessage(JSON.stringify(o),this.Vi)}else this.$t.ULS.u(593232848,r.N,n.Info,"Missing target to send message")},t.prototype.dispose=function(){window.removeEventListener("message",this.$i,!1),this.Ki=void 0},t}();!function(t){t.Qi="access_token",t.Yi="access_token_ttl",t.tn="bundleSrc",t.in="bundleStaleness",t.nn="DocID",t.on="ETag",t.rn="feature_status",t.sn="fileExtension",t.an="fileGetUrl",t.cn="fileName",t.un="fileSize",t.fn="forceSLR",t.hn="frameHeightPx",t.dn="frameWidthtPx",t.ln="highContrast",t.pn="highDpi",t.vn="host_diagnostics",t.mn="hostName",t.wn="huictrls",t.gn="owner_id",t.In="sc",t.Sn="softBlockedBrowser",t.bn="templateUrl",t.Cn="touchMode",t.yn="user_id"}(Tt||(Tt={}));function Pt(t,e){var i=y(e);t.setAttribute("allow","microphone "+i+"; camera "+i+";")}function Ut(t,e){T(e,Tt.hn,String(t.offsetHeight)),T(e,Tt.dn,String(t.offsetWidth)),T(e,Tt.Cn,String(v())),T(e,Tt.ln,String(m())),T(e,Tt.fn,String(g()))}function Rt(t){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(e){return t&&t.ULS.u(591525084,r.N,n.Info,"Trust check error: "+Y(e)),!1}}var Nt,xt=function(){function t(t,e){var i=this;this.On=null,this._n=function(t){var e=t.target;i.On=e.contentWindow,i.On?i.Tn.setTargetWindow(i.On):i.$t.ULS.u(592524689,r.N,n.Error,"Content window not available")},function(t){if(void 0===t||void 0===t.appendChild)throw TypeError("Container")}(t),this.An=t,this.En=e,this.Pn=e+"_Form",this.Un=Rt()}return Object.defineProperty(t.prototype,"element",{get:function(){return this.An},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameId",{get:function(){return this.En},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formId",{get:function(){return this.Pn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTopFrameTrusted",{get:function(){return this.Un},enumerable:!0,configurable:!0}),t.prototype.boot=function(t,e,i){this.$t=i,this.Tn=new Et(t,i,this.Ki),this.Rn&&this.On?(Pt(this.Rn,t),this.Tn.setTargetWindow(this.On),this.$t.ULS.u(588793045,r.N,n.Info,"Reuse iframe and content window")):(this.Rn=function(t,e,i,n){var o=t.ownerDocument.createElement("iframe");return o.id=e,o.name=e,o.src="",o.title="Office on the web Frame",o.width="100%",o.height="100%",o.marginWidth="0",o.marginHeight="0",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.display="block",o.style.position="absolute",o.style.backgroundColor="transparent",o.style.border="none",o.frameBorder="0",o.setAttribute("allowfullscreen","true"),o.setAttribute("allowTransparency","true"),Pt(o,i),n&&o.addEventListener("load",n,{once:!0}),t.appendChild(o),o}(this.An,this.En,t,this._n),this.$t.ULS.u(588793046,r.N,n.Info,"Wac frame created")),Ut(this.Rn,e),this.Nn=function(t,e,i,n,o){var r=t.ownerDocument,s=r.createElement("form");for(var a in s.id=i,s.name=i,s.action=n,s.target=e,s.method="POST",o){var c=r.createElement("input");c.type="hidden",c.name=a,c.value=o[a],s.appendChild(c)}return t.appendChild(s),s}(this.An,this.En,this.Pn,t,e),this.Nn.submit()},t.prototype.setMessageHandler=function(t){this.Ki=t,this.Tn&&this.Tn.setMessageHandler(t)},t.prototype.removeMessageHandler=function(){this.Ki=void 0,this.Tn&&this.Tn.removeMessageHandler()},t.prototype.postMessage=function(t,e){this.Tn&&this.Tn.postMessage(t,e)},t.prototype.dispose=function(t,e){var i=this;return new Promise((function(n){if(i.Nn&&(i.An.removeChild(i.Nn),i.Nn=void 0),i.Tn&&(i.Tn.dispose(),i.Tn=void 0,i.Ki=void 0),i.$t=void 0,i.Rn&&!t){var o=function(){i.An.removeChild(i.Rn),i.Rn=void 0,n()};e?o():(i.Rn.src="about:blank",window.setTimeout(o,0))}else n()}))},t}(),Ft=function(){function t(t,e,i){var n=this;this.sessions=[],this.containers=[],this.xn=function(t){n.Fn.dispatch(t)},function(t){if(void 0===t)throw new TypeError("ApplicationInitParams");var e=t.host;if(void 0===e||void 0===e.storageHostName)throw new TypeError("HostInfo");var i=t.user;if(void 0===i||void 0===i.id)throw new TypeError("UserInfo")}(t),this.Wn=t,this.kn=e,this.Mn=i,this.Fn=new bt,p()}return Object.defineProperty(t.prototype,"name",{get:function(){return this.kn.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return Z()},enumerable:!0,configurable:!0}),t.prototype.addEventListener=function(t){this.Fn.add(t)},t.prototype.removeEventListener=function(t){this.Fn.remove(t)},t.prototype.createContainer=function(t){var e="WacFrame_"+this.kn.name+"_"+this.containers.length,i=new xt(t,e);return this.containers.push(i),i},t.prototype.createSession=function(t){var e=new At(this.Wn,this.kn,t,this,this.xn,this.Mn);return this.sessions.push(e),e},t.prototype.dispose=function(t){var e=this,i=this.sessions.map((function(e){return e.dispose(t).catch((function(t){}))}));return Promise.all(i).then((function(t){return e.Fn.removeAll(),e.sessions=[],e.containers=[],{completion:"success"}}))},t}();function Wt(t){var e=t.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}function kt(t,e){e&&e.Diagnostics&&Object.keys(e.Diagnostics).forEach((function(i){return t[i]=e.Diagnostics[i]}))}function Mt(t,e,i){e.ULS.u(596459999,r.N,i,"SessionTraces: "+JSON.stringify(t))}function Dt(t,e){e.Stop();var i=e.GetVisibilityChangeEvents();null!=i&&i.length>0&&(t.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,t.SessionTraces.tabSwitchDiagnostics=JSON.stringify(i)),e.Dispose()}function Ht(t,e,i){try{var o=function(t,e){var i=h({},e);delete i.UserId,delete i.OwnerId,delete i.WdParams;var n=i,o=e.WdParams?JSON.parse(JSON.stringify(e.WdParams).toLowerCase()):{};return n.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(t){o[t]&&(n.WdParams[t]=o[t])})),n.UiEmbedMode=t.toLowerCase().indexOf("uiembed=1")>=0,n.UiHostName=A(t,"uih")||"N/A",n.HostDomain=location?location.hostname:"",n}(e.applicationUrl,e.sessionInformation);o.Build=Z(),o.Region=C(e.applicationUrl);var s=h({},e.rebootOverrideData);delete s.ackExpected,delete s["ui-language"],delete s.wdUserSession,delete s.rebootMode,delete s.documentUrl,o.RebootOverride=s,e.diagnostics.HostInitDiagnostics&&(t.ULS.u(596444238,r.N,n.Info,"HostInitDiagnostics: "+JSON.stringify(e.diagnostics.HostInitDiagnostics)),o.SessionOrigin=e.diagnostics.HostInitDiagnostics.entryPoint),i&&t.ULS.u(595937313,r.N,n.Info,JSON.stringify(i)),t.ULS.u(595632928,r.N,n.Info,function(){if(window&&window.navigator){var t=window.navigator,e=t.connection||t.mozConnection||t.webkitConnection;if(e)return"EffectiveType: "+e.effectiveType+", BandwidthMps: "+e.downlink+", ConnectionType: "+e.type}return""}());var a=e.wopiInfo;a&&a.AccessToken&&a.AccessTokenExpiry||t.ULS.u(595894553,r.N,n.Warning,"There are some missing parameters"),a&&(a.AccessToken&&(o.AccessTokenLength=a.AccessToken.length),o.AccessTokenExpiry=a.AccessTokenExpiry);var c=ft.Rt;o.JsApiVersion=e.featureManager.isFeatureEnabled(c)?"v1Wrapper":"v1",t.ULS.u(596444237,r.N,n.Info,JSON.stringify({session:o,client:it()}))}catch(e){t.ULS.u(590915460,r.N,n.Error,"Failed to log initialization info: "+Y(e))}}function Bt(t){if("undefined"!=typeof navigator&&navigator.virtualKeyboard&&void 0!==navigator.virtualKeyboard.overlaysContent&&window===top)return navigator.virtualKeyboard.overlaysContent=t}!function(t){t.Unknown="Unknown",t.AppInitError="AppInitError",t.ApiDisabledError="ApiDisabledError",t.CannotLoadFirstPage="CannotLoadFirstPage",t.CannotLoadScript="CannotLoadScript",t.PageChangeError="PageChangeError",t.ZoomChangeError="ZoomChangeError",t.CannotLoadBundleItem="CannotLoadBundleItem",t.InvalidPageIndex="InvalidPageIndex",t.UnsupportedBundleVersion="UnsupportedBundleVersion",t.InvalidWopiInfo="InvalidWopiInfo",t.TimeoutWacReady="TimeoutWacReady",t.WacFailed="WacFailed"}(Nt||(Nt={}));var Jt,Lt=function(t,e,i,n,o){return new Promise((function(t){Bt(e.overlayContent),i.container&&i.container.postMessage(gt.Ui,void 0),t({completion:"success"})}))};function jt(t,e,i){void 0===i&&(i=!1);var n=t.applicationUrl;t.wopiPrecheckInfo.IsNewFile&&n.replace("unified=1","edit=1&new=1");var o={jsApi:"1"},r=ft.Rt;if(o.jsapiver=t.featureManager.isFeatureEnabled(r)?"v1Wrapper":"v1",i&&(o.NewSession="1"),o.corrid=t.sessionId,o.usid=t.sessionId,o.sftc="1",(t.applicationCustomSettings&&t.applicationCustomSettings.IsCore||t.sessionInformation.IsCore)&&(o.core="1"),t.sessionInformation.HideViewerToolbar&&(o.hvt="1"),t.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),t.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(t.sessionInformation.HighContrastMode)),t.sessionInformation.SupportsAtMentions&&(o.sams="1"),t.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),t.sessionInformation.SupportsDocReboot){var s=t.sessionInformation.SupportsDocReboot;o.sdr=!0===s?"1":s.toString()}return t.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),t.sessionInformation.SupportsAuthToken&&(o.sat="1"),t.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),t.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),t.sessionInformation.SupportsExcelExternalLinks&&(o.xlel="1"),t.sessionInformation.SupportsRefreshAccessToken&&(o.rat="1"),t.sessionInformation.HideHeader&&(o.hhdr="1"),t.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),t.sessionInformation.HideTitleInViewer&&(o.htv="1"),t.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),t.applicationCustomSettings&&t.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),(t.wopiPrecheckInfo.ReadOnly||e.bootFlowType===Jt.wordViewToUnifiedReadRedirect)&&(o.readOnly="1"),e.bootFlowType===Jt.wordViewToUnifiedReadRedirect&&(o.cons="1"),t.sessionInformation.UIEmbed&&(o.uiEmbed="1"),t.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(t.sessionInformation.UiHostIntegrationType)),t.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(t.sessionInformation.MetaUiHostVersion)),t.applicationCustomSettings&&t.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),e.isSingleStepBoot?(e.bootFlowType===Jt.unifiedSingleFlush&&(t.isCreateNew||(o.instantedit="1",o.wopicomplete="1")),o.wdRedirectionReason=e.bootFlowType):(o.instantedit="1",o.fileSrc=encodeURIComponent(t.sessionInformation.HostName),o.pmOrigin=encodeURIComponent(y(window.location.href)),t.isCreateNew&&(o.new="1",t.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(o.wdTpl="fromhost"))),t.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(t.wopiPrecheckInfo.PreseededSessionKey)),t.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(t.wopiPrecheckInfo.PreseededWacSessionId)),t.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=t.wopiPrecheckInfo.RequestedCallThrottling),t.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=t.wopiPrecheckInfo.ClientThrottlingProtection),t.applicationCustomSettings&&t.applicationCustomSettings.additionalApplicationParameters&&(o=h(h({},t.applicationCustomSettings.additionalApplicationParameters),o)),t.rebootOverrideData&&t.rebootOverrideData.queryOverrides&&(o=h(h({},o),t.rebootOverrideData.queryOverrides)),function(t,e,i,n,o){var r=P(t);"teams"!==r.uih&&"owa"!==r.uih||(r.hhdr="1");var s=t.indexOf("?"),a=-1===s?t.concat("?"):t.substring(0,s+1);e.UiLocale&&(r.ui=encodeURIComponent(e.UiLocale));e.DataLocale&&(r.rs=encodeURIComponent(e.DataLocale));e.HostSessionId&&(r.hid=encodeURIComponent(e.HostSessionId));e.DisableChat&&(r.dchat="1");e.SessionContext&&(r.sc=encodeURIComponent(e.SessionContext));i&&i.WopiSrc&&(r.wopisrc=encodeURIComponent(i.WopiSrc));e.CookieCompliant&&(r.mscc="1");n&&(n.entryPoint&&(r.wdorigin=encodeURI(n.entryPoint)),n.userClickTime&&(r.wdhostclicktime=n.userClickTime.toString()));r=h(h(h({},r),e.WdParams),o);var c={};for(var u in r)c[u.toLowerCase()]=r[u];var f=[];for(var u in c)c[u]&&f.push(u.concat("=",c[u]));return a.concat(f.join("&"))}(n,t.sessionInformation,t.wopiInfo,t.diagnostics.HostInitDiagnostics,o)}function Vt(t){return t.AccessTokenExpiry?t.AccessTokenExpiry.getTime().toString():"0"}!function(t){t.bootWithoutWopiInfo="",t.unifiedSingleFlush="Unified_SingleFlush",t.unifiedIrmEnabled="Unified_IrmEnabled",t.unifiedViewActionUrl="Unified_ViewActionUrl",t.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",t.forceSingleStepBoot="Force_SingleStepBoot",t.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",t.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",t.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect"}(Jt||(Jt={}));var zt,Gt,qt,Zt,$t,Xt,Kt,Qt,Yt,te,ee=["xlviewerinternal.aspx","xlembed.aspx"];function ie(t,e,i,o){Xt=t,Kt=e,Qt=void 0,Yt=i,te=o,zt=!1,Gt=!1,qt=0,se(),setTimeout((function(){Xt.ULS.u(593589517,r.N,n.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver heartbeat signal called after ms: 3000")}),3e3),setTimeout((function(){!function t(){if(qt>=3)return void Xt.ULS.u(595350870,r.N,n.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Max Limit reached for retry attempts3");if(se(),zt)setTimeout((function(){(!Gt||qt>0)&&Xt.ULS.u(595350872,r.N,n.Info,"ExcelLandingPageObserver: checkSecondFlushArrived Second Flush status: "+Gt+" after first flush retry attempt: "+qt)}),$t);else{if(qt+=1,Xt.ULS.u(595350871,r.N,n.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Retry Request: "+qt),Yt.isFeatureEnabled(ft.Ft)&&1===qt)document.getElementById(Kt).submit();setTimeout((function(){t()}),Zt)}}()}),Zt),Yt.isFeatureEnabled(ft.xt)&&(window.localStorage?window.addEventListener("offline",ae):Xt.ULS.u(593589518,r.N,n.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver localstorage not supported by Browser. Skip saving in cache")),Xt.ULS.u(594622165,r.N,n.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver called with OfflineTelemetry: "+Yt.isFeatureEnabled(ft.xt))}function ne(t){"PageLoadSkeleton Presented"===t?zt=!0:"BootstapContext Recieved"===t&&(Gt=!0)}function oe(){if(Yt.isFeatureEnabled(ft.xt))if(window.localStorage)for(var t=0;t<localStorage.length;t+=1)try{var e=localStorage.key(t);if("OfflineMode_"===e.substring(0,"OfflineMode_".length)){var i=localStorage.getItem(e);Xt.ULS.u(593589520,r.N,n.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry Message"+i),localStorage.removeItem(e)}}catch(t){Xt.ULS.u(593589521,r.N,n.Error,"ExcelLandingPageObserver:uploadOfflineModeTelemetry exception during loading from cache. Exception: "+Y(t))}else Xt.ULS.u(593589519,r.N,n.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry localstorage not supported by Browser. Skip uploading")}function re(t){return ee.some((function(e){return-1!==t.indexOf(e)}))}function se(){Zt=3750,$t=6e3;var t=function(){if(window&&window.navigator){var t=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return t?t.effectiveType:void 0}}();if(void 0!==t)switch(void 0!==Qt&&Qt!==t&&Xt.ULS.u(595350873,r.N,n.Info,"ExcelLandingPageObserver: initializeTimeOutIntervals previousConnection: "+Qt+" currentConnection: "+t+" First Flush: "+zt+" Second Flush:"+Gt),Qt=t,t){case"4g":Zt=3750,$t=6e3;break;case"3g":Zt=5e3,$t=8e3;break;case"2g":Zt=1e4,$t=24e3;break;case"slow-2g":Zt=2e4,$t=4e4}}function ae(){try{var t=J(),e="OfflineMode_"+te+"_"+t,i={"Sessionid:":te,OfflineTime:t};localStorage.setItem(e,JSON.stringify(i))}catch(t){Xt.ULS.u(593589522,r.N,n.Error,"ExcelLandingPageObserver:logOfflineModeTelemetry exception during saving into cache exception: "+Y(t))}}function ce(t,e,i,n,o,r,s){var a=function(t,e,i,n){var o=t.ownerDocument.createElement("iframe");o.name=i||"WebApplicationFrame",o.id="WebApplicationFrame",o.src="",o.title="Office Online Frame",o.width="100%",o.height="100%",o.marginWidth="0",o.marginHeight="0",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.display="block",o.style.position="absolute",o.style.backgroundColor="transparent",o.style.border="none",o.frameBorder="0",o.setAttribute("allowfullscreen","true"),o.setAttribute("allowTransparency","true");var r=y(e);return o.setAttribute("allow","microphone "+r+"; camera "+r+";"),n&&(o.onload=n),t.appendChild(o),o}(t,e,o);return re(e)&&ie(r,"office_form",n,s),function(t,e,i,n){Ut(t,n);var o=e.ownerDocument,r=o.createElement("form");for(var s in r.id="office_form",r.name="office_form",r.action=i,r.target=t.name,r.method="POST",n){var a=o.createElement("input");a.type="hidden",a.name=s,a.value=n[s],r.appendChild(a)}return e.appendChild(r),r.submit(),t}(a,t,e,i)}var ue=function(){function t(t,e,i,n,o,r){var s=this;if(this.Dn=!1,this.Hn=[],this.logWarningOnNoAppComplete=function(t){s.Dn||ht(s.$t,t)},void 0===e)throw new TypeError("bootFlowInfo");if(e.isSingleStepBoot&&void 0===t.wopiInfo)throw new TypeError("wopiInfo");this.Bn=t,this.Jn=e,this.$t=i,this.Ln=n,this.jn=o,this.Vn=r,this.zn=t.diagnostics.AppInitDiagnostics,this.Gn=t.diagnostics.SessionTraces,this.Gn.wopiInitializeTime=J()}return t.prototype.Boot=function(){var t=this;this.$t.ULS.u(596444241,r.N,n.Info,"Initializing WAC frame");var e=jt(this.Bn,this.Jn,!0),i=function(t,e){var i={};if(t.wopiInfo&&(i[Tt.Qi]=t.wopiInfo.AccessToken,i[Tt.Yi]=Vt(t.wopiInfo)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0)if(i[Tt.tn]=t.wopiPrecheckInfo.BundleInfo.Url,null!=t.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==t.wopiPrecheckInfo.BundleInfo.BundleStaleness){var o=t.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();e.ULS.u(593503580,r.N,n.Info,"Content bundle staleness - "+o),i[Tt.in]=o}else e.ULS.u(593503581,r.N,n.Info,"Content bundle staleness does not exist");if(t.wopiPrecheckInfo.FileGetUrl&&(i[Tt.an]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.FileName){var s=t.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==s){var a=t.wopiPrecheckInfo.FileName.substring(s+1);a&&(i[Tt.sn]=a)}i[Tt.cn]=t.wopiPrecheckInfo.FileName}return t.newFileTemplateSource&&t.newFileTemplateSource.FileSize?i[Tt.un]=t.newFileTemplateSource.FileSize.toString():t.wopiPrecheckInfo.FileSize&&(i[Tt.un]=t.wopiPrecheckInfo.FileSize.toString()),t.sessionInformation.UserId&&(i[Tt.yn]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(i[Tt.gn]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(i[Tt.In]=t.sessionInformation.SessionContext),t.diagnostics.HostInitDiagnostics&&(i[Tt.vn]=JSON.stringify({HostInitializeDiagnostics:t.diagnostics.HostInitDiagnostics})),i[Tt.rn]=pt(t.featureManager,t.sessionInformation.WdParams),t.applicationCustomSettings&&t.applicationCustomSettings.HostUIControls&&(i[Tt.wn]=JSON.stringify(t.applicationCustomSettings.HostUIControls)),i[Tt.pn]=String(window.devicePixelRatio>1.24),i[Tt.Sn]=String(w()),i[Tt.mn]=t.sessionInformation.HostName,t.newFileTemplateSource&&(i[Tt.bn]=t.newFileTemplateSource.FileGetUrl),t.newFileTemplateSource&&t.newFileTemplateSource.DocUniqueId?i[Tt.nn]=t.newFileTemplateSource.DocUniqueId:t.wopiPrecheckInfo.DocUniqueId&&(i[Tt.nn]=t.wopiPrecheckInfo.DocUniqueId),t.newFileTemplateSource&&t.newFileTemplateSource.ETag?i[Tt.on]=t.newFileTemplateSource.ETag:t.wopiPrecheckInfo.ETag&&(i[Tt.on]=t.wopiPrecheckInfo.ETag),i}(this.Bn,this.$t);if(ct(S(e),this.Bn.Et,this.$t,this.logWarningOnNoAppComplete),this.Ln.registerMessagePayloadHandler(wt.re,(function(e){t.handleWacAppBootState(e)})),this.Ln.registerMessagePayloadHandler(wt.ue,(function(){t.handleCloseTab()})),this.Ln.registerMessagePayloadHandler(wt.Oe,(function(e){t.handleTrustFrameRequest(e)})),this.Ln.registerMessagePayloadHandler(wt.je,(function(e){t.handleSetOverlayContent(e)})),this.Jn.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(e,i),this.Jn.ignoreWacFramePostMessages){var o=this.getApplicationState();this.jn(o)}return this.$t.ULS.u(595661019,r.N,n.Info,"Created Wac Frame"),this.qn},t.prototype.bootWacFrame=function(t,e){this.zn.officeFrameCreateTime=J(),this.Gn.frameCreateStartTime=this.zn.officeFrameCreateTime;var i=this.Bn.applicationCustomSettings&&this.Bn.applicationCustomSettings.appFrameName;this.qn=ce(this.Bn.container,t,e,this.Bn.featureManager,i,this.$t,this.Bn.sessionId),this.Ln.activate(this.qn)},t.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var t=this;this.Ln.registerMessagePayloadHandler(wt.se,(function(e){t.handleWacCompleteMessage(e)})),this.Ln.registerMessagePayloadHandler(wt.oe,(function(e){t.handleWacFailureMessage(e)})),this.Hn.push(window.setTimeout((function(){return t.timeoutWacAppCompleteOrFail()}),15e3)),this.Hn.push(window.setTimeout((function(){return t.logWarningOnNoAppComplete(1)}),this.Bn.Et.getValue(j.gt,6e4))),this.Hn.push(window.setTimeout((function(){return t.logWarningOnNoAppComplete(2)}),this.Bn.Et.getValue(j.It,18e4)))},t.prototype.handleWacAppBootState=function(t){var e=t&&t.state?t.state:"unknown";this.$t.ULS.u(595714271,r.N,n.Info,"WAC Boot App state:["+e+"]"),ne(e)},t.prototype.handleTrustFrameRequest=function(t){var e=Rt(this.$t);this.$t.ULS.u(595653903,r.N,n.Info,"Top frame is trusted: "+e),this.Ln.sendPostMessage(this.qn.contentWindow,gt.Oe,{isTopFrameTrusted:e})},t.prototype.handleSetOverlayContent=function(t){var e=Bt(t&&t.overlayContent);this.$t.ULS.u(587487432,r.N,n.Info,"Overlay content: "+e),this.Ln.sendPostMessage(this.qn.contentWindow,gt.Ui,void 0)},t.prototype.handleWacCompleteMessage=function(t){if(this.$t.ULS.u(595986314,r.N,n.Info,"Received wac complete message"),this.$t.ULS.flush(),ut(),this.clearLogTimers(),oe(),this.Dn)this.$t.ULS.u(596444234,r.N,n.Info,"Received multiple wac complete or failure messages");else{this.Dn=!0,this.sendWacPostMessage(gt.si,{}),kt(this.zn,t);var e=this.getApplicationState();this.jn(e),this.sendJsApiDiagnosticsToWacFrame(this.Bn.diagnostics)}},t.prototype.handleCloseTab=function(){this.$t.ULS.u(579342464,r.N,n.Info,"Received close tab message");try{window.close()}catch(t){this.$t.ULS.u(579213188,r.N,n.Warning,"Failed to close the browser tab")}},t.prototype.getApplicationState=function(){return{innerApplicationFrame:this.qn}},t.prototype.handleWacFailureMessage=function(t){if(this.$t.ULS.u(595986315,r.N,n.Error,"Received wac failed message"),this.$t.ULS.flush(),ut(),this.clearLogTimers(),this.Dn)this.$t.ULS.u(596444235,r.N,n.Info,"Received multiple wac complete or failure messages");else{this.Dn=!0,this.sendWacPostMessage(gt.ri,{});var e={errorType:Nt.WacFailed,errorObject:{}};t&&(e.errorObject=t.Error,this.Gn.error=e),this.Vn(e)}},t.prototype.timeoutWacAppCompleteOrFail=function(){this.Dn||this.$t.ULS.u(596444236,r.N,n.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.Gn))},t.prototype.clearLogTimers=function(){dt(this.Hn),this.Hn=[]},t.prototype.sendJsApiDiagnosticsToWacFrame=function(t){this.sendWacPostMessage(gt.pi,{HostInitializeDiagnostics:t.HostInitDiagnostics})},t.prototype.sendWacPostMessage=function(t,e){this.qn&&this.qn.contentWindow?this.Ln.sendPostMessage(this.qn.contentWindow,t,e):this.$t.ULS.u(595955718,r.N,n.Info,"Attempted to send postmessage: "+t)},t}(),fe=!1,he=!1;function de(){fe=!1}function le(t,e,i,o,s,a,c){if(e.ULS.u(595714433,r.N,n.Info,"Starting disposing the application. unloadApp:"+t+"; disposed:"+fe+"; unloading:"+he),fe||he&&t)e.ULS.u(595714908,r.N,n.Info,"Application is already disposed or unloading");else{var u,f={logger:e,postMessenger:i,innerApplicationFrame:o,onDisposed:s,onFrameRemoved:a,unloadTimeoutInMs:c||1e3,forceAppUnload:!1,disposeStartTime:J(),appUnloadTimedOut:!1};if(t&&o)return he=!0,f.forceAppUnload=!0,(u=f).forceAppUnloadStartTime=J(),u.logger.ULS.u(595855490,r.N,n.Info,"Sending postmessage to unload app"),u.logger.ULS.flush(),u.postMessenger.registerMessagePayloadHandler(wt.qe,(function(t){return function(t,e){t.forceAppUnloadEndTime=J(),t.appUnloadedMessageValues=e,t.logger.ULS.u(595855491,r.N,n.Info,"AppUnloaded received from app"),pe(t)}(u,t)})),u.postMessenger.sendPostMessage(u.innerApplicationFrame.contentWindow,gt.xi,{}),void window.setTimeout((function(){return function(t){!he&&fe||(t.appUnloadTimedOut=!0,t.logger.ULS.u(595855492,r.N,n.Info,"ApplicationUnload timed out, forcing dispose"),pe(t))}(u)}),u.unloadTimeoutInMs);pe(f)}}function pe(t){if(!fe)try{fe=!0,he=!1,function(t){if(!t.innerApplicationFrame)return;t.innerApplicationFrame.src="about:blank",window.setTimeout((function(){t.innerApplicationFrame&&t.innerApplicationFrame.parentElement&&t.innerApplicationFrame.parentElement.removeChild(t.innerApplicationFrame),t.onFrameRemoved&&t.onFrameRemoved()}),0)}(t),function(t){var e={disposeStartTime:t.disposeStartTime,disposeEndTime:J(),forceAppUnload:t.forceAppUnload,appUnloadTimedOut:t.appUnloadTimedOut};t.forceAppUnloadStartTime&&(e.appUnloadStartTime=t.forceAppUnloadStartTime);t.forceAppUnloadEndTime&&(e.appUnloadEndTime=t.forceAppUnloadEndTime);if(t.appUnloadedMessageValues){var i=t.appUnloadedMessageValues,o=Number(i.hostMessageReceived);t.forceAppUnloadStartTime&&!isNaN(o)&&(e.hostToAppPostMessageLatency=o-t.forceAppUnloadStartTime);var s=Number(i.appMessageSent);!isNaN(s)&&t.forceAppUnloadEndTime&&(e.appToHostPostMessageLatency=t.forceAppUnloadEndTime-s);var a=Number(i.appUnloadStart),c=Number(i.appUnloadEnd);if(isNaN(a)||isNaN(c)||(e.appUnloadLatency=c-a),i.serverTimings){var u=i.serverTimings;for(var f in u)e["st-"+f.toString()]=u[f]}}t.logger.ULS.u(595855436,r.N,n.Info,"App disposed "+JSON.stringify(e)),t.logger.ULS.flushOnClose()}(t),t.onDisposed&&t.onDisposed()}catch(e){t.logger.ULS.u(595714434,r.N,n.Error,"Error disposing: "+Y(e))}}var ve,me=function(){function t(t,e,i,n,o,r,s){var a=this;this.Zn=!1,this.$n=!1,this.Xn=!1,this.Kn=null,this.Qn=!0,this.Yn=!1,this.to=!1,this.Bn=t,this.Jn=e,this.zn=t.diagnostics.AppInitDiagnostics,this.$t=i,this.Ln=n,this.jn=r,this.Vn=s,this.Gn=t.diagnostics.SessionTraces,this.Gn.wopiPendingInitializeTime=J(),this.eo=o,de(),window.setTimeout((function(){return a.timeoutCompleteOrFail()}),5e3)}return t.prototype.Complete=function(t,e){if(this.Xn)this.$t.ULS.u(596444184,r.N,n.Warning,"Complete called after Complete/Fail already called");else{this.$t.ULS.u(596444185,r.N,n.Info,"Complete called."),this.Xn=!0,this.io=t,this.Gn.wopiPendingCompleteTime=J();try{this.Jn.isSingleStepBoot?this.completeSingleStepFlow():this.completeTwoStepFlow(),this.Zn&&this.sendWacPostMessage(gt.Ri,{}),this.updateBrowserHistoryForCreateNew(e)}catch(t){this.$t.ULS.u(596444186,r.N,n.Error,"Unexpected script error: "+Y(t))}finally{this.$t.ULS.flush()}}},t.prototype.Fail=function(t){this.Xn?this.$t.ULS.u(596444187,r.N,n.Warning,"Fail called after Complete/Fail already called"):(this.$t.ULS.u(596444188,r.N,n.Warning,"Fail called. Reason: "+(t?JSON.stringify(t):"N/A")),this.Xn=!0,this.Jn.isSingleStepBoot?this.failSingleStepFlow():this.failTwoStepFlow(t),this.$t.ULS.flush())},t.prototype.Dispose=function(t,e,i){var n=this;le(t||!1,this.$t,this.Ln,this.qn,(function(){delete n.qn,e&&e(),n.eo(),n.Ln.dispose()}),void 0,i)},t.prototype.Boot=function(){this.Jn.isSingleStepBoot||this.bootTwoStepFlow(),this.$t.ULS.flush()},t.prototype.bootTwoStepFlow=function(){var t=this;this.$t.ULS.u(596444231,r.N,n.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout((function(){return t.timeoutWacReadyMessage()}),5e3),this.Ln.registerMessagePayloadHandler(wt.ne,(function(e){t.handleWacReadyMessage(e)})),this.Ln.registerMessagePayloadHandler(wt.Le,(function(e){t.handleWacFrameSessionCompleteAckMessage(e)}));var e=new ue(this.Bn,this.Jn,this.$t,this.Ln,this.jn,this.Vn);this.qn=e.Boot()},t.prototype.completeTwoStepFlow=function(){var t={ParallelizeStartSession:this.Qn,WacFrameIsLoaded:this.Zn,WacAcceptsStartSessionComplete:this.Yn};this.$t.ULS.u(596444232,r.N,n.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(t)),!this.Qn||this.Zn&&!this.Yn?this.Zn&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},t.prototype.completeSingleStepFlow=function(){this.$t.ULS.u(596444233,r.N,n.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.Bn.wopiInfo=this.io;var t=new ue(this.Bn,this.Jn,this.$t,this.Ln,this.jn,this.Vn);this.qn=t.Boot()},t.prototype.failTwoStepFlow=function(t){this.Zn?(this.$t.ULS.u(595968481,r.N,n.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(t)):(this.$t.ULS.u(595968482,r.N,n.Warning,"Fail was called on the session prior to WacReady."),this.Kn=t)},t.prototype.sendFailurePostMessageToWacFrame=function(t){this.$t.ULS.u(596444189,r.N,n.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(gt.Pi,t)},t.prototype.failSingleStepFlow=function(){this.$t.ULS.u(596444190,r.N,n.Warning,"Fail called during single step boot, calling host failure callback..."),this.Vn({errorType:Nt.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},t.prototype.timeoutWacReadyMessage=function(){this.Zn||(this.$t.ULS.u(596444191,r.N,n.Warning,"Timeout Wac Ready"),this.Vn({errorType:Nt.TimeoutWacReady,errorObject:void 0}))},t.prototype.timeoutCompleteOrFail=function(){this.Xn||(this.Gn.timeoutCompleteOrFail=J(),this.$t.ULS.u(596444192,r.N,n.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.Gn)))},t.prototype.timeoutWacSessionCompletionMessageAck=function(t,e,i){this.to||(this.$t.ULS.u(596444193,r.N,n.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(t,e,i+1))},t.prototype.handleWacReadyMessage=function(t){if(this.Gn.readyMessageReceiveTime=J(),this.sendWacPostMessage(gt.ii,{}),this.Zn)this.$t.ULS.u(596444194,r.N,n.Info,"Received multiple ready messages - frame is already loaded.");else{this.Zn=!0,this.Yn=t&&t.CanAcceptStartSessionComplete;var e={AcceptStartSessionComplete:this.Yn,ParallelizeStartSession:this.Qn,StartSessionResponse:null!=this.no,WopiInfo:null!=this.io};this.$t.ULS.u(596444195,r.N,n.Info,"HandleWacReadyMessage - "+JSON.stringify(e)),this.Xn&&(this.Kn?this.sendFailurePostMessageToWacFrame(this.Kn):this.sendWacPostMessage(gt.Ri,{})),this.Qn&&this.Yn?this.no&&this.startSessionCompleted():this.io&&this.sendWopiInfoToWacFrame(),kt(this.zn,t)}},t.prototype.handleWacFrameSessionCompleteAckMessage=function(t){this.to=!0,this.Gn.sessionCompleteAckReceivedTime=J()},t.prototype.sendWacPostMessage=function(t,e){this.qn&&this.Ln.sendPostMessage(this.qn.contentWindow,t,e)},t.prototype.sendSessionCompletionMessageWithRetry=function(t,e){this.sendSessionCompletionMessageWithRetryHelper(t,e,1)},t.prototype.sendSessionCompletionMessageWithRetryHelper=function(t,e,i){var o=this;if(i>3)this.$t.ULS.u(596444224,r.N,n.Error,"Attempted to call complete, but received no ack from the frame. Time: "+J());else{this.$t.ULS.u(596444225,r.N,n.Info,"Sending completion message to frame. Attempt number: "+i+", Time: "+J());var s=J();1===i&&(this.no&&this.no.Diagnostics&&(this.no.Diagnostics.completeMessageCreateTime=s),this.Gn.completeMessageCreateTime=s),e.Diagnostics.completeMessageSendTime=s,this.Gn.completeMessageSendTime=s,this.sendWacPostMessage(t,e),window.setTimeout((function(){return o.timeoutWacSessionCompletionMessageAck(t,e,i)}),1e3)}},t.prototype.makeStartSessionRequest=function(){var t=this;this.$t.ULS.u(596444226,r.N,n.Info,"Making parallelized startSession request.");var e=this.buildStartSessionUrl(this.io),i={"Content-Type":"application/x-www-form-urlencoded"},o="access_token="+encodeURIComponent(this.io.AccessToken)+"&access_token_ttl="+encodeURIComponent(Vt(this.io));this.Gn.startSessionStartTime=J(),function(t,e,i,n){var o=new XMLHttpRequest;for(var r in o.onreadystatechange=function(){if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{n&&n(o)}finally{null!=o&&(o.onreadystatechange=function(){})}}},o.open("POST",t),i)o.setRequestHeader(r,i[r]);o.send(e)}(e,o,i,(function(e){return t.onStartSessionRequestCompleted(e)}))},t.prototype.onStartSessionRequestCompleted=function(t){if(this.Gn.startSessionCompleteTime=J(),this.Gn.startSessionResponseStatus=t.status,this.no={StartSessionResponse:{RequestStatus:t.status,ResponseText:t.responseText},Diagnostics:{wopiPendingInitializeTime:this.Gn.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Gn.wopiPendingCompleteTime,startSessionStartTime:this.Gn.startSessionStartTime,startSessionCompleteTime:this.Gn.startSessionCompleteTime,readyMessageReceiveTime:this.Gn.readyMessageReceiveTime}},this.$t.ULS.u(596444227,r.N,n.Info,"StartSession request completed with status code: "+this.no.StartSessionResponse.RequestStatus+", Time: "+J()),this.Zn&&this.Yn)this.startSessionCompleted();else{var e={WacFrameIsLoaded:this.Zn,InitializeCompleted:this.$n};this.$t.ULS.u(596444228,r.N,n.Info,"StartSessionCompleted not called - "+JSON.stringify(e))}},t.prototype.sendWopiInfoToWacFrame=function(){if(!this.$n){this.$n=!0,this.$t.ULS.u(596444229,r.N,n.Info,"Sending wopi info to the frame.");var t={WopiDetails:{WopiSrc:this.io.WopiSrc,AccessToken:this.io.AccessToken,AccessTokenTtl:Vt(this.io)},Diagnostics:{wopiPendingInitializeTime:this.Gn.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Gn.wopiPendingCompleteTime,readyMessageReceiveTime:this.Gn.readyMessageReceiveTime}};this.sendSessionCompletionMessageWithRetry(gt.ci,t)}},t.prototype.startSessionCompleted=function(){200===this.no.StartSessionResponse.RequestStatus?this.$n||(this.$n=!0,this.sendSessionCompletionMessageWithRetry(gt.ai,this.no)):this.sendWopiInfoToWacFrame()},t.prototype.buildStartSessionUrl=function(t){var e=this.Bn.applicationBasePath+"wordeditorstartsession.ashx",i=jt(this.Bn,this.Jn,!1);return e=E(e+="?"+i.substring(i.indexOf("?")+1),"WOPISrc",encodeURIComponent(t.WopiSrc)),e=E(e,"build",encodeURIComponent(Z())),e=E(e,"WacUserType",encodeURIComponent("WOPI")),this.Bn.wopiPrecheckInfo.FileGetUrl&&(e=E(e,"fileGetUrlPresent","1")),e},t.prototype.updateBrowserHistoryForCreateNew=function(t){if(this.Bn.isCreateNew){if(!t||!t.NewFilePath)return void this.$t.ULS.u(596444230,r.N,n.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",t.NewFilePath),t.UpdatedPageTitle&&(document.title=t.UpdatedPageTitle)}},t}(),we=((ve={})[mt.blurFocus]=gt.oi,ve[mt.continueAccessibilityLoop]=gt.hi,ve[mt.grabFocus]=gt.di,ve[mt.popState]=gt.mi,ve[mt.rename]=gt.gi,ve[mt.sendAccessToken]=gt.Ii,ve[mt.sendAuthToken]=gt.Si,ve[mt.sendCustomAuthConfig]=gt.bi,ve[mt.sendEmbeddedViewUrl]=gt.yi,ve[mt.sendSessionInfo]=gt.Oi,ve[mt.sendUserAccessAndPermissions]=gt._i,ve[mt.sendWopiInfo]=gt.Ti,ve[mt.switchMode]=gt.Ni,ve),ge=function(){function t(t,e){var i=this;if(this.oo=!1,this.so=function(t){return i.handleWacFramePostMessage(t)},this.Zi=!1,this.Gi=!1,this.qi=!1,this.ao={},!t)throw new Error("Missing origin for PostMessageHandler");this.Gi=S(t),this.qi=b(t),this.$t=e,this.setOrigin(t)}return t.prototype.registerMessagePayloadHandler=function(t,e){if(this.ao[t])throw new Error("Duplicate registration!");this.ao[t]=e},t.prototype.removeMessageHandler=function(t){delete this.ao[t]},t.prototype.sendPostMessage=function(t,e,i){if(t){this.$t.ULS.u(596464334,r.N,n.Info,"Sending message: "+e);var o={MessageId:e,SendTime:J(),Values:i};this.sendPostMessageInternal(t,JSON.stringify(o),this.Vi)}else this.$t.ULS.u(595948308,r.N,n.Info,"Missing target for SendPostMessage")},t.prototype.activate=function(t,e){void 0===e&&(e=!1),this.qn=t,this.Zi=e,this.oo||(window.addEventListener("message",this.so,!1),this.oo=!0)},t.prototype.postMessageForCommand=function(t,e,i){var o=we[e];o?(this.$t.ULS.u(595702598,r.N,n.Info,"Sending message "+o+" for command "+e),this.sendPostMessage(t,o,i)):this.$t.ULS.u(595702599,r.N,n.Warning,"No mapping for command "+e)},t.prototype.dispose=function(){for(var t=0,e=Object.keys(this.ao);t<e.length;t++){var i=e[t];delete this.ao[i]}this.oo&&(window.removeEventListener("message",this.so,!1),this.oo=!1)},t.prototype.sendAckBack=function(t,e,i){if(t){var o={MessageId:gt.ei,CorrelationId:i,SendTime:J()};this.$t.ULS.u(595732176,r.N,n.Info,"Sending Ack back"),t.postMessage(JSON.stringify(o),e)}else this.$t.ULS.u(595736136,r.N,n.Info,"Missing target to send Ack back")},t.prototype.handleWacFramePostMessage=function(t){var e=!1,i=!0,o="",s=!1;if(this.qn&&this.qn.contentWindow&&(e=!0,i=t.source===this.qn.contentWindow),t.origin&&(s=(o=O(t.origin,2).toLowerCase())===this.zi),!this.Gi&&(!this.qi||s&&i)||this.$t.ULS.u(595730526,r.N,n.Info,"Window is available: "+e+", window is valid: "+i+", origin is valid: "+s+", expected origin: "+this.zi+", actual origin: "+o),s&&(!this.Zi||i)){var a;try{a=JSON.parse(t.data)}catch(t){return void this.$t.ULS.u(596464282,r.N,n.Info,"Failed to parse event data: "+Y(t)+".")}var c=a.MessageId;if(c){this.$t.ULS.u(595714715,r.N,n.Info,"Received messageId: "+c+", correlation: "+a.CorrelationId),c!==wt.se&&c!==wt.Pe||this.setOrigin(t.origin),a.Values&&a.Values.ackExpected&&this.sendAckBack(t.source,t.origin,a.CorrelationId);var u=this.ao[c];if(u){this.$t.ULS.u(596464288,r.N,n.Info,"Processing message: "+c);try{u(a.Values||{})}catch(t){this.$t.ULS.u(593773704,r.N,n.Error,"Handler error: "+Y(t))}}else this.$t.ULS.u(596464289,r.N,n.Info,"No handler found for message id: "+c)}else(this.Gi||this.qi)&&this.$t.ULS.u(595730520,r.N,n.Info,"Could not find message id")}},t.prototype.sendPostMessageInternal=function(t,e,i){t.postMessage(e,i)},t.prototype.setOrigin=function(t){var e=t.toLowerCase();this.Vi&&this.Vi!==e&&this.$t.ULS.u(596128131,r.N,n.Warning,"Updating origin:"+this.Vi+"->"+e),this.Vi=e,this.zi=O(e,2),this.Gi=S(e),this.qi=b(e)},t}(),Ie=function(){function t(){var t=this;if(this.co=[],this.ao=[],this.uo=function(){return t.handleVisibilityChange()},"hidden"===document.visibilityState){var e={visibility:document.visibilityState,time:J(),initialState:!0};this.co.push(e)}document.addEventListener("visibilitychange",this.uo)}return t.prototype.RegisterEventHandler=function(t){this.ao.push(t)},t.prototype.RemoveEventHandler=function(t){if(t){var e=this.ao.indexOf(t);this.ao.splice(e,1)}},t.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.uo)},t.prototype.GetVisibilityChangeEvents=function(){return this.co},t.prototype.Dispose=function(){this.Stop(),this.ao=[],this.co=[]},t.prototype.handleVisibilityChange=function(){var t={visibility:document.visibilityState,time:J(),initialState:!1};this.co.push(t);for(var e=0,i=this.ao;e<i.length;e++){var n=i[e];n&&n(t)}},t}();function Se(t,e,i,n,o,r){void 0===r&&(r=!1),t.SessionInformation.IsCore&&(t.SessionInformation.HideViewerToolbar=!0),function(t,e){var i=t.SessionInformation;i.WdParams||(i.WdParams={});if(i.WdParams.wd)return;e.substring(1).split("&").filter((function(t){if(0===t.indexOf("wd")){var e=t.split("=");e[0].length>2&&(i.WdParams[e[0]]=e[1])}}));var n=t.RebootOverrideData;n&&n.previousSessionId&&(i.WdParams.wdprevioussession=n.previousSessionId)}(t,window.location.search);var s=o||new Ct("Excel",i);return{container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:t.Diagnostics,AppInitDiagnostics:{officeSessionId:e,officeBootstrapperVersion:Z(),hostName:t.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:e,applicationBasePath:Wt(t.ApplicationUrl),wopiInfo:t.WopiInfo,forceSingleStepBoot:r,isCreateNew:t.WopiPrecheckInfo.IsNewFile||N(t.ApplicationUrl),featureManager:n||lt(t.FnIsFeatureEnabled,i),Et:s,newFileTemplateSource:t.NewFileTemplateSource,rebootOverrideData:t.RebootOverrideData}}var be=["excel-boot.min.js"];function Ce(t){window.performance&&window.performance.getEntriesByType&&window.addEventListener("load",(function(){try{for(var e=0,i=window.performance.getEntriesByType("resource");e<i.length;e++){var o=i[e],s=U(o.name);if("about:blank"!==o.name&&-1===s.indexOf("RemoteUls.ashx")&&-1===s.indexOf("mhtml:file")&&-1!==be.indexOf(s)){var a=JSON.stringify(o);a=a.replace(new RegExp(o.name,"g"),s),t.ULS.u(595736532,r.N,n.Info,a)}}window.performance.clearResourceTimings()}catch(e){t.ULS.u(595732049,r.N,n.Info,"ExcelPreloader.tryObserveResourceTiming: could not trace resource timing, error is: "+JSON.stringify(e))}}),{once:!0})}var ye,Oe=function(){function t(t,e){this.fo=t,this.ho=e}return t.prototype.GetVersion=function(){return Z()},t.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},t.prototype.Prefetch=function(t){if(null!=t&&void 0!==t){var e=document.createElement("link");e.rel="prefetch";var i=t.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),e.href=i;var n=document.getElementsByTagName("head")[0];null!=n&&void 0!==n&&n.appendChild(e)}},t.prototype.InitializeWopiPending=function(t,e,i,o,s,a){var c,u,f,h,d,l=!1;try{var v,m=J();!function(t){if(void 0===t)throw new TypeError("initParams");var e=t.Container;if(void 0===e||void 0===e.appendChild)throw new TypeError("Container");var i=t.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");var n=t.ApplicationUrl;if(void 0===n||"string"!=typeof n)throw new TypeError("ApplicationUrl");var o=t.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===t.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===t.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(t),function(t){var e,i=t.RebootOverrideData;if(i)if(i.queryOverrides||(i.queryOverrides={}),e=i.mode)"view"===(e=e.toLowerCase())?i.queryOverrides.wdforcedmode="View":"edit"===e&&(i.queryOverrides.wdforcedmode="Edit");else{var n=i.reason;n&&"saveas"===(n=n.toLowerCase())&&(i.queryOverrides.wdforcedmode="Edit")}}(t),i?f=i:(f=(c=Ot())[0],h=c[1]),u=e||G({remoteUlsEndpoint:Wt(t.ApplicationUrl)+"RemoteUls.ashx",sessionId:f}),d=Se(t,f,u,s,a,this.ho.forceSingleStepBoot),a||(d.Et.addSettingsChangeListener(u.settingsChangeHandler),d.Et.initializePeriodicFetch(d.applicationBasePath,f)),d.diagnostics.HostInitDiagnostics&&(d.diagnostics.HostInitDiagnostics.hostInitializeCallTime=m),Ht(u,d,h),l=!0,ot(u,!0);var w=t.BootstrapperUrl;w&&(v=this.periodicPrefetch(w,u));var g=function(){d.Et.dispose(),rt(),window.clearInterval(v)},I=y(t.ApplicationUrl),S=o||new ge(I,u),b=new Ie,C=function(t,e){var i={isSingleStepBoot:t.forceSingleStepBoot,bootFlowType:t.forceSingleStepBoot?Jt.forceSingleStepBoot:Jt.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(t.forceSingleStepBoot,i.isSingleStepBoot){var o={singleStepBootIsRequired:!0,singleStepBootReason:i.bootFlowType,irmEnabled:t.wopiPrecheckInfo.IrmEnabled,readOnly:t.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:i.ignoreWacFramePostMessages};e.ULS.u(596444182,r.N,o.irmEnabled?n.Warning:n.Info,JSON.stringify(o))}else e.ULS.u(596444183,r.N,n.Info,"Received input valid for two step flow");return i}(d,u),O=function(t,e,i,o,s,a,c,u){return function(f){Dt(t,s),Mt(t.SessionTraces,o,n.Info);var h=Te(t);o.ULS.u(596448985,r.N,n.Info,JSON.stringify(h));var d=u(e,o,i,a,f);try{c(d,h)}catch(t){o.ULS.u(595719171,r.N,n.Error,"Exception thrown from host's success callback: "+Y(t))}tt("excel",o),_e(o)}}(d.diagnostics,d.sessionId,S,u,b,g,t.FnOnInitializeSuccess,this.fo),_=function(t,e,i,o){return function(s){Dt(t,i),Mt(t.SessionTraces,e,n.Warning);var a=Te(t);e.ULS.u(596448986,r.N,n.Error,JSON.stringify({error:s,appInitDiagnostics:a}));try{o(s,a)}catch(t){e.ULS.u(595719172,r.N,n.Error,"Exception thrown from host's failure callback: "+Y(t))}tt("excel",e),_e(e)}}(d.diagnostics,u,b,t.FnOnInitializeFailure);if(p(),t.FnOnAppModeSwitched&&S.registerMessagePayloadHandler(wt.Ue,t.FnOnAppModeSwitched),t.WopiPrecheckInfo.ReadOnly&&t.FnOnAppModeSwitched,w&&this.ho.preloader&&this.ho.preloader.shouldPreload(d.applicationUrl))try{var T=w;Ce(u),d.featureManager.isFeatureEnabled(ft.Wt)&&(u.ULS.u(595645891,r.N,n.Info,"HTTP2 preload enabled"),T=R(w));var E=d.sessionInformation.UiLocale;E||(E=decodeURIComponent(A(d.applicationUrl,"ui"))),this.ho.preloader.preload(T,E,u,d.featureManager)}catch(t){u.ULS.u(595943884,r.N,n.Error,Y(t))}var P=new me(d,C,u,S,g,O,_);return P.Boot(),P}catch(e){return u&&(u.ULS.u(596459925,r.N,n.Error,Nt.AppInitError+": "+Y(e)),l||Ht(u,d||Se(t,f,u,s,a,this.ho.forceSingleStepBoot),h),u.ULS.flushOnClose()),void t.FnOnInitializeFailure({errorType:Nt.AppInitError,errorObject:e},void 0)}},t.prototype.periodicPrefetch=function(t,e){var i=this;return window.setInterval((function(){i.Prefetch({BootstrapperUrl:t}),e.ULS.u(595895774,r.N,n.Info,"Prefetching "+U(t))}),36e5)},t}();function _e(t){t.ULS.u(590914655,r.N,n.Info,"Time spent logging: "+t.getTimeSpentLogging())}function Te(t){return h(h(h({},t.AppInitDiagnostics),t.HostInitDiagnostics),{SessionTraces:t.SessionTraces})}!function(t){t.BrowserEvent="BrowserEvent",t.PageChanged="PageChanged",t.ZoomChanged="ZoomChanged",t.ContentRefreshBegin="ContentRefreshBegin",t.ContentRefreshEnd="ContentRefreshEnd",t.AppClosed="UI_Close",t.UserEdit="Edit_Notification",t.FileRename="File_Rename",t.FileShare="UI_Sharing",t.ShowFileVersions="UI_FileVersions",t.UIWorkflow="UI_Workflow",t.IsDisabled="IsDisabled",t.AccessibilityLoopComplete="App_AccessibilityLoopComplete",t.Unloaded="Unloaded",t.Disposed="Disposed",t.SwitchMode="App_SwitchMode",t.DocumentReboot="DocReboot",t.WopiInfoFromUrl="WopiInfoFromUrl",t.ModeSwitched="ModeSwitched",t.CreateNewDocument="App_CreateNewDocument",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.SetOverlayContent="SetOverlayContent"}(ye||(ye={}));var Ae=[wt.ge,wt._e,wt.De,wt.Xe],Ee=function(){function t(t,e,i,n,o){this.ao={},this.do=!1,this.lo=!1,this.po=t,this.$t=e,this.qn=o.innerApplicationFrame,this.Ln=i,this.vo=n,this.registerPostMessageHandlers(),de()}return t.prototype.GetApplicationType=function(){throw new Error("Not implemented")},t.prototype.GetVersion=function(){return Z()},t.prototype.GetSessionId=function(){return this.po},t.prototype.RegisterEventHandler=function(t,e){if(this.lo)throw new Error("RegisterEventHandler is not supposed to be called");this.do=!0,this.registerEventHandlerInternal(t,e)},t.prototype.RemoveEventHandler=function(t,e){if(this.lo)throw new Error("RemoveEventHandler is not supposed to be called");switch(t){case ye.Unloaded:case ye.Disposed:case ye.DocumentReboot:case ye.WopiInfoFromUrl:case ye.GetAuthToken:case ye.GetCustomAuthConfig:case ye.SetOverlayContent:if(this.ao[t]!==e)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.ao[t];break;default:this.Ln.removeMessageHandler(t)}},t.prototype.RegisterErrorHandler=function(t){},t.prototype.RemoveErrorHandler=function(t){},t.prototype.RegisterAllEventsHandler=function(t){var e=this;if(this.do)throw new Error("RegisterAllEventsHandler is not supposed to be called");if(this.lo)throw new Error("RegisterAllEventsHandler is supposed to be called only once");this.lo=!0,Ae.forEach((function(i){e.registerEventHandlerInternal(i,(function(e){return t({MessageId:i,SendTime:void 0,CorrelationId:void 0,Values:e})}))})),Object.keys(yt).forEach((function(i){yt[i].Di&&e.registerEventHandlerInternal(i,(function(e){return t({MessageId:i,SendTime:void 0,CorrelationId:void 0,Values:e})}))})),this.registerEventHandlerInternal(ye.WopiInfoFromUrl,(function(e){t({MessageId:wt.Ee,SendTime:void 0,CorrelationId:void 0,Values:e})})),this.registerEventHandlerInternal(ye.GetAuthToken,(function(e){t({MessageId:wt.Te,SendTime:void 0,CorrelationId:void 0,Values:e})})),this.registerEventHandlerInternal(ye.GetCustomAuthConfig,(function(e){t({MessageId:wt.Ae,SendTime:void 0,CorrelationId:void 0,Values:e})})),this.registerEventHandlerInternal(ye.DocumentReboot,(function(e){t({MessageId:wt.ke,SendTime:void 0,CorrelationId:void 0,Values:e})}))},t.prototype.PostCommand=function(t,e){this.Ln.postMessageForCommand(this.qn.contentWindow,t,e)},t.prototype.Dispose=function(t,e){var i=this;le(t||!1,this.$t,this.Ln,this.qn,(function(){delete i.qn,i.vo(),i.Ln.dispose(),i.raiseEvent(ye.Unloaded,{})}),(function(){try{i.raiseEvent(ye.Disposed,{}),i.ao={}}catch(t){i.$t.ULS.u(589108815,r.N,n.Error,"onFrameRemoved error: "+Y(t))}}),e)},t.prototype.registerEventHandlerInternal=function(t,e){switch(t){case ye.Unloaded:case ye.Disposed:case ye.DocumentReboot:case ye.WopiInfoFromUrl:case ye.GetAuthToken:case ye.GetCustomAuthConfig:case ye.SetOverlayContent:if(this.ao[t])throw new Error("Duplicate registration");this.ao[t]=e;break;default:this.Ln.registerMessagePayloadHandler(t,e)}},t.prototype.registerPostMessageHandlers=function(){this.Ln.registerMessagePayloadHandler(wt.ke,this.handleDocumentRebootMessage.bind(this)),this.Ln.registerMessagePayloadHandler(wt.Ee,this.handleWopiInfoFromUrlRequest.bind(this)),this.Ln.registerMessagePayloadHandler(wt.Te,this.handleAuthTokenRequest.bind(this)),this.Ln.registerMessagePayloadHandler(wt.Ae,this.handleCustomAuthConfigRequest.bind(this))},t.prototype.raiseEvent=function(t,e){var i=this.ao[t];if(i)try{i(e||{})}catch(t){this.$t.ULS.u(593773706,r.N,n.Error,"Handler error: "+Y(t))}},t.prototype.handleDocumentRebootMessage=function(t){t.previousSessionId=this.po,this.raiseEvent(ye.DocumentReboot,t)},t.prototype.handleWopiInfoFromUrlRequest=function(t){this.raiseEvent(ye.WopiInfoFromUrl,t)},t.prototype.handleAuthTokenRequest=function(t){this.raiseEvent(ye.GetAuthToken,t)},t.prototype.handleCustomAuthConfigRequest=function(t){this.raiseEvent(ye.GetCustomAuthConfig,t)},t}();var Pe="_layouts/xlviewerinternal.aspx";function Ue(t){return t.toLowerCase().indexOf(Pe.split("/")[1])>0}function Re(t,e,i,o){var s={};try{s=JSON.parse( "{\"ewa.js\": {\"UrlHash\": \"h8714A29D138EFD3D\", \"SriHash\": \"hxSinROO/T3Li0I9i83XoV7L2NI+9FU35cZOLmzxtXU=\"}, \"aacorlib.min.js\": {\"UrlHash\": \"h6A0D5A441D484E3E\", \"SriHash\": \"ag1aRB1ITj4EkgY69VuGDmmpsLTq7JTQl1Z+qZGFjbo=\"}, \"ewa.strings.wac.js\": {\"UrlHash\": \"hE9022D59DD0C3781\", \"SriHash\": \"6QItWd0MN4HeN+6tQThrmt9fHmgrQx92yebEbuouc/0=\"}, \"ewrdefault.css\": {\"UrlHash\": \"hA92EEDFFC005635E\", \"SriHash\": \"qS7t/8AFY16fMFNGOKoBk64pVdSLPefavCX5ZZMJ/7M=\"}, \"excelframe.css\": {\"UrlHash\": \"hBB4883F0BE47BD2F\", \"SriHash\": \"u0iD8L5HvS+U/SRt3xayAp3shs7YLBiXTSVoKnHwYjA=\"}, \"cookiecompliance.js\": {\"UrlHash\": \"h910F1F3CE687CFDE\", \"SriHash\": \"kQ8fPOaHz94aEkFf5zpEZeei+FEXfDPKjp87XF+TxBw=\"}, \"gridrenderer.min.js\": {\"UrlHash\": \"h8353D34871BAFAF7\", \"SriHash\": \"g1PTSHG6+vcEUWC3FAptuQSumd5/dl4e44gUSpXdjwI=\"}}")}catch(t){o&&o.ULS.u(589178847,r.N,n.Info,"GetExcelResources failed to parse hash dictionary")}for(var a=y(t)+"/x/s/",c=Q(),u=null!=e?e:"en-US",f=function(t){var e=t?t.toLowerCase().split("-")[0]:"en";return M[e]}(u),h=[],d=0,l=function(t,e){var i=[["App_Scripts/Ewa.js",!1],["App_Scripts/Aacorlib.min.js",!1],["App_Scripts/gridRenderer.min.js",!1]];e&&(i=i.concat([["Resources/"+e+"/ClientManifest.js",!1]]));t&&(i=i.concat([["App_Scripts/"+t+"/Ewa.Strings.Wac.js",!0],["Resources/"+t+"/EwrDefault.css",!0],["Resources/"+t+"/excelframe.css",!0]]));return i}(f,u);d<l.length;d++){var p=l[d],v=p[0],m=p[1],w=v.substring(v.lastIndexOf("/")+1);if(be.push(w),!m||"1033"===f){var g=w.toLowerCase();if(s&&s[g]){var I=s[g].UrlHash;I&&(h.push(a+I+"__layouts/"+v),o&&o.ULS.u(589178849,r.N,n.Info,"GetExcelResources adding hashed url for "+w))}else h.push(a+c+"__layouts/"+v),v.indexOf("ClientManifest.js")>=0&&h.push(a+c+"_"+v),o&&o.ULS.u(589178848,r.N,n.Info,"GetExcelResources adding versioned url for "+w)}}return h}var Ne,xe=function(t,e,i,o,s){return new Promise((function(t){i.pendingReboot=!0;var o=void 0;if(e.queryOverrides)try{o=JSON.parse(e.queryOverrides)}catch(t){i.logger.ULS.u(592217694,r.N,n.Error,"Failed to parse queryOverrides: "+o)}i.raiseEvent(It.Reboot,h(h({},e),{previousSessionId:i.sessionId,queryOverrides:o})),t({completion:"success"})}))},Fe=function(t,e,i){return new Promise((function(e){i.logger.ULS.u(590111070,r.N,n.Error,"Unsupported flow: "+t),e({completion:"failure"})}))},We=((Ne={})[wt.ge]={Di:It.FileEmbed,mo:mt.sendEmbeddedViewUrl,wo:gt.yi},Ne[wt._e]={Di:It.GetAccessToken,mo:mt.sendAccessToken,wo:gt.Ii},Ne[wt.Te]={Di:It.GetAuthToken,mo:mt.sendAuthToken,wo:gt.Si},Ne[wt.Ae]={Di:It.GetCustomAuthConfig,mo:mt.sendCustomAuthConfig,wo:gt.bi},Ne[wt.Ee]={Di:It.GetWopiInfoFromUrl,mo:mt.sendWopiInfo,wo:gt.Ti},Ne[wt.De]={Di:It.RefreshSessionInfo,mo:mt.sendSessionInfo,wo:gt.Oi},Ne[wt.Xe]={Di:It.UserAccessAndPermissions,mo:mt.sendUserAccessAndPermissions,wo:gt._i},Ne),ke=function(t,e,i){var n=We[t];return n?new Promise((function(t){var o=function(t,e){i.container&&i.container.postMessage(n.wo,e),r({completion:"success"})},r=function(e){i.removeActionHandler(n.mo,o),t(e)};i.addActionHandler(n.mo,o),i.raiseEvent(n.Di,e)})):Fe(t,0,i)},Me=function(){function t(t){var e=this;this.Io=!1,this.So=[],this.cancel=function(){e.Io||(e.Io=!0,e.So.map((function(t){return t()})),e.So=[])},window.setTimeout(this.cancel,t)}return Object.defineProperty(t.prototype,"isCancelled",{get:function(){return this.Io},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){this.Io?t():this.So.push(t)},t}();function De(t){return new Me(t)}function He(t,e,i,n){var o=We[t];return o?new Promise((function(t){var r=function(t,e){i.application&&i.application.PostCommand(o.mo,e),s({completion:"success"})},s=function(i){e.removeActionHandler(o.mo,r),t(i)};e.addActionHandler(o.mo,r),new Me(5e3).subscribe((function(){s({completion:"cancelled"})})),e.raiseEvent(o.Di,n)})):Fe(t,0,e)}function Be(t,e){if(void 0===t)throw new TypeError("SessionBootParams");var i=t.appUrl,n=t.appBaseUrl;if(void 0===i&&void 0===n)throw new TypeError("Either appUrl or appBaseUrl should exist");if(void 0!==i&&"string"!=typeof i)throw new TypeError("AppUrl");if(void 0!==n&&"string"!=typeof n)throw new TypeError("AppBaseUrl");var o=t.file;if(void 0===o||void 0===o.name)throw new TypeError("FileInfo");var r,s=t.container;if(void 0===s||!(s instanceof xt)&&void 0===s.appendChild)throw new TypeError("Container");if(!e&&(!((r=t.wopi)&&r.source&&r.accessToken)||!r.expiry&&0!==r.expiry))throw new TypeError("WopiInfo")}function Je(t,e,i,o,s,a){return t!==mt.boot?Promise.reject("Wrong flow"):new Promise((function(t){var c,u;Be(o,e.skipWopiValidation),e.state=k.Booting,e.pendingReboot=!1,e.appBaseUrl=o.appBaseUrl?o.appBaseUrl.toLowerCase():y(o.appUrl).toLowerCase(),e.appUrl=o.appUrl||"",e.bootParams=o.bootParams||{},e.appUrl&&N(e.appUrl)&&(e.bootParams.isNewFile=!0),e.rebootOverride=o.rebootOverride,e.appBasePath=s.buildAppBasePath(e),e.intent=o.intent,e.file=o.file,e.wopi=o.wopi,e.contentBundle=o.contentBundle,e.newFileTemplate=o.newFileTemplate,e.ownerId=o.ownerId,e.sessionContext=o.sessionContext,e.actNavId=o.actNavId,e.wdParams=o.wdParams,e.preseededSession=o.preseededSession,e.throttling=o.throttling,e.hostInitDiagnostics=o.diagnostics,e.appInitDiagnostics={},o.rebootOverride&&(c=Ot(),e.sessionId=c[0],u=c[1],e.Et.addSettingsChangeListener(e.logger.settingsChangeHandler)),e.logger.configure({remoteUlsEndpoint:_(e.appBasePath),sessionId:e.sessionId}),e.Et.initializePeriodicFetch(e.appBasePath,e.sessionId),u&&e.logger.ULS.u(589842332,r.N,n.Info,JSON.stringify(u));var f=function(n,o){i.error=n,i.appInitDiagnostics=o,e.appInitDiagnostics=o;var r={completion:"failure",error:n};e.raiseEvent(It.BootCompleted,r),e.state=k.Failed,t(r)};a&&a.subscribe((function(){f({errorType:"Cancelled",errorObject:void 0})}));var h=function(t,e,i,n){var o=t.appBasePath+Pe+"?";if(t.appUrl){var r=P(t.appUrl);Object.keys(r).forEach((function(t){o+=t+"="+r[t]+"&"}))}var s=t.ui;s&&s.uiEmbed&&(o=E(o,"uiembed","1"));var a=t.host;a.uiHostName&&(o=E(o,"uih",a.uiHostName));var c=t.user;c.isLicensed&&(o=E(o,"islicenseduser","1"));e.actNavId&&(o=E(o,"actnavid",e.actNavId));var u=e.container,f=u instanceof xt?u.element:u,h=e.bootParams,d=t.viewMode,l=a.capabilities,p=e.file,v=e.contentBundle,m=e.preseededSession,w=e.throttling,g=e.wopi,I=e.newFileTemplate;return{BootstrapperUrl:t.bootstrapperUrl,Container:f,SessionInformation:{HostName:t.hostName,HostSessionId:t.hostSessionId,UserId:c.id,OwnerId:e.ownerId,UiLocale:s&&s.language,DataLocale:h&&h.dataLanguage,DisableChat:h&&h.disableChat,CookieCompliant:h&&h.cookieCompliant,WdParams:e.wdParams,SessionContext:e.sessionContext,DisableFocusOnBoot:d&&d.disableFocusOnBoot,HighContrastMode:s?s.highContrast:void 0,HideViewerToolbar:d&&d.hideToolbar,SupportsAccessibilityLoop:l&&l.accessibilityLoop,SupportsAtMentions:l&&l.atMentions,SupportsDocReboot:l&&l.rebootDoc,SupportsCreateNewDocument:l&&l.createNewDoc,SupportsAuthToken:l&&l.authToken,SupportsCustomAuthConfig:l&&l.customAuthConfig,SupportsMoveToFolder:l&&l.moveToFolder,SupportsExcelExternalLinks:l&&l.excelExternalLinks,SupportsRefreshAccessToken:l&&l.refreshAccessToken,HideHeader:s&&s.hideHeader,HideBreadCrumbInViewer:d&&d.hideBreadCrumb,HideTitleInViewer:d&&d.hideTitle,HideWACOneDriveFileLocationPicker:s&&s.hideFileLocationPicker,UiHostIntegrationType:a&&a.uiHostIntegrationType,MetaUiHostVersion:a&&a.metaUiHostVersion},ApplicationUrl:o,WopiPrecheckInfo:{FileName:p.name,FileGetUrl:p.getUrl,FileSize:p.size,BundleInfo:v?{MajorVersion:v.majorVersion,Url:v.url,BundleStaleness:v.staleness}:void 0,IsNewFile:h&&h.isNewFile,IsNewFileFromHostTemplate:h&&h.isFromHostTemplate,ReadOnly:h&&h.readOnly,IrmEnabled:h&&h.irmEnabled,ETag:p.eTag,PreseededSessionKey:m&&m.key,PreseededWacSessionId:m&&m.id,DocUniqueId:p.uniqueId,ClientThrottlingProtection:w&&w.protection,RequestedCallThrottling:w&&w.request},ApplicationCustomSettings:{HostUIControls:s&&s.controls},Diagnostics:e.diagnostics,WopiInfo:{WopiSrc:g.source,AccessToken:g.accessToken,AccessTokenExpiry:new Date(g.expiry)},FnOnInitializeSuccess:i,FnOnInitializeFailure:n,NewFileTemplateSource:I?{FileGetUrl:I.getUrl,FileSize:I.size,ETag:I.eTag,DocUniqueId:I.uniqueId}:void 0,RebootOverrideData:e.rebootOverride}}(e,o,(function(n,o){if(!a||!a.isCancelled){i.application=n,i.appInitDiagnostics=o,e.appInitDiagnostics=o,n.RegisterAllEventsHandler((function(t){e.onMessage(t)}));var r={completion:"success"};e.raiseEvent(It.BootCompleted,r),e.state=k.Booted,t(r)}}),f),d=i.bootstrapper.InitializeWopiPending(h,e.logger,e.sessionId,void 0,e.featureManager,e.Et);d&&d.Complete(h.WopiInfo),i.pendingApplication=d}))}function Le(t){return t.appBaseUrl+"/x/"}var je=function(){var t,e,i={bootstrapper:ri};return[(t={},t[vt.accessToken]=function(t,e,n,o){return He(t,n,i,e)},t[vt.appReboot]=xe,t[vt.authToken]=function(t,e,n,o){return He(t,n,i,e)},t[vt.boot]=function(t,e,n,o,r){return Je(t,n,i,e,o,r)},t[vt.closeTab]=Fe,t[vt.createNew]=Fe,t[vt.customAuthConfig]=function(t,e,n,o){return He(t,n,i,e)},t[vt.dispose]=function(t,e,n,o,r){return function(t,e,i,n){return t!==mt.dispose?Promise.reject("Wrong flow"):new Promise((function(t){e.state=k.Disposing;var o=!!e.host.requireExplicitUnload,r=function(){var i={completion:"success"};e.raiseEvent(It.Disposed,i),e.state=k.Disposed,t(i)};if(n&&n.subscribe((function(){t({completion:"cancelled"})})),i.application){var s=i.application;o&&s.registerEventHandlerInternal(ye.Disposed,r),s.Dispose(o),o||r()}else i.pendingApplication?i.pendingApplication.Dispose(o,r):r()}))}(t,n,i,r)},t[vt.fileEmbed]=function(t,e,n,o){return He(t,n,i,e)},t[vt.frameTrust]=Fe,t[vt.handleBootState]=Fe,t[vt.postMessage]=function(t,e,n,o,r){return function(t,e,i,n,o){return i.application.PostCommand(t,n),Promise.resolve({completion:"success"})}(t,0,i,e)},t[vt.refreshSessionInfo]=function(t,e,n,o){return He(t,n,i,e)},t[vt.rename]=function(t,e,n,o,r){return function(t,e,i,n,o){return new Promise((function(r){var s=function(t,e){var i={completion:e.NewName===n.NewName?"success":"failure"};c(i)},a=function(t,e){c({completion:"failure"})},c=function(t){e.removeActionHandler(wt.Se,s),e.removeActionHandler(wt.be,a),r(t)};e.addActionHandler(wt.Se,s),e.addActionHandler(wt.be,a),(o||new Me(5e3)).subscribe((function(){c({completion:"cancelled"})})),i.application&&i.application.PostCommand(t,n)}))}(t,n,i,e,r)},t[vt.setOverlayContent]=Fe,t[vt.switchMode]=function(t,e,n,o,r){return function(t,e,i,n,o){return new Promise((function(r){var s=function(t,e){a({completion:"success"})},a=function(t){e.removeActionHandler(wt.Ue,s),r(t)};e.addActionHandler(wt.Ue,s),(o||new Me(5e3)).subscribe((function(){a({completion:"cancelled"})})),i.application&&i.application.PostCommand(t,n)}))}(t,n,i,e,r)},t[vt.userAccessAndPermissions]=function(t,e,n,o){return He(t,n,i,e)},t[vt.wopiInfoFromUrl]=function(t,e,n,o){return He(t,n,i,e)},t),(e={},e[vt.boot]={buildAppBasePath:Le,buildBootRequestParams:function(){return{appPageName:"",queryParamsOverrides:{},postDataOverrides:{}}}},e)]};function Ve(t,e,i){var n=h(h(h({},P(t.appUrl)),function(t){var e={};T(e,"jsapi","1"),T(e,"jsapiver","v2"),T(e,"corrid",t.sessionId),T(e,"usid",t.sessionId),T(e,"newsession","1"),T(e,"sftc","1"),t.hostSessionId&&T(e,"hid",encodeURIComponent(t.hostSessionId));var i=t.host;i.uiHostName&&T(e,"uih",i.uiHostName),i.uiHostIntegrationType&&T(e,"uihit",encodeURIComponent(i.uiHostIntegrationType)),i.metaUiHostVersion&&T(e,"muv",encodeURIComponent(i.metaUiHostVersion));var n=i.capabilities;n&&(n.accessibilityLoop&&T(e,"accloop","1"),n.rebootDoc&&T(e,"sdr",n.rebootDoc.toString()),n.createNewDoc&&T(e,"scnd","1"),n.authToken&&T(e,"sat","1"),n.customAuthConfig&&T(e,"cac","1"),n.excelExternalLinks&&T(e,"xlel","1"),n.refreshAccessToken&&T(e,"rat","1"),n.atMentions&&T(e,"sams","1"),n.moveToFolder&&T(e,"mtf","1"));var o=t.ui;o&&(o.language&&T(e,"ui",encodeURIComponent(o.language)),o.uiEmbed&&T(e,"uiembed","1"),o.hideHeader&&T(e,"hhdr","1"),o.highContrast&&T(e,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&T(e,"hodflp","1"));var r=t.wopi;r&&r.source&&T(e,"wopisrc",encodeURIComponent(r.source));var s=t.bootParams;s&&(s.dataLanguage&&T(e,"rs",encodeURIComponent(s.dataLanguage)),s.readOnly&&T(e,"readonly","1"),s.disableChat&&T(e,"dchat","1"),s.cookieCompliant&&T(e,"mscc","1"),s.isNewFile&&(T(e,"new","1"),s.isFromHostTemplate&&T(e,"wdtpl","fromhost"))),t.user.isLicensed&&T(e,"islicenseduser","1"),t.actNavId&&T(e,"actnavid",t.actNavId),t.sessionContext&&T(e,"sc",encodeURIComponent(t.sessionContext));var a=t.wdParams;if(a)for(var c in a)T(e,c,a[c]);var u=t.preseededSession;u&&(u.key&&T(e,"preseededsessionkey",encodeURIComponent(u.key)),u.id&&T(e,"preseededwacsessionid",encodeURIComponent(u.id)));var f=t.throttling;f&&(f.protection&&T(e,"ctp",f.protection),f.request&&T(e,"rct",f.request));var h=t.hostInitDiagnostics;h&&(h.entryPoint&&T(e,"wdorigin",encodeURI(h.entryPoint)),h.userClickTime&&T(e,"wdhostclicktime",h.userClickTime.toString()));var d=t.rebootOverride;return d&&d.previousSessionId&&T(e,"wdprevioussession",d.previousSessionId),e}(t)),i),o=t.rebootOverride;return o&&o.queryOverrides&&(n=h(h({},n),o.queryOverrides)),function(t,e,i){var n=[];for(var o in i)i[o]&&n.push(o+"="+i[o]);return t+e+(n.length>0?"?"+n.join("&"):"")}(t.appBasePath,e,n)}function ze(t,e){var i=function(t){var e={};T(e,Tt.pn,String(window.devicePixelRatio>1.24)),T(e,Tt.Sn,String(w())),T(e,Tt.mn,t.hostName),T(e,Tt.rn,pt(t.featureManager,t.wdParams));var i=t.wopi;i&&(T(e,Tt.Qi,i.accessToken),T(e,Tt.Yi,i.expiry.toString()));var o=t.contentBundle;if(o&&o.url&&o.url.length>0){T(e,Tt.tn,o.url);var s=o.staleness,a=null!=s;a&&T(e,Tt.in,s.toString()),t.logger.ULS.u(577783775,r.N,n.Info,"Content bundle staleness: "+(a?s:"N/A"))}var c=t.file,u=c.name;if(u){T(e,Tt.cn,u);var f=u.lastIndexOf(".");if(-1!==f){var h=u.substring(f+1);h&&T(e,Tt.sn,h)}}c.getUrl&&T(e,Tt.an,c.getUrl),c.size&&T(e,Tt.un,c.size.toString()),c.eTag&&T(e,Tt.on,c.eTag),c.uniqueId&&T(e,Tt.nn,c.uniqueId);var d=t.newFileTemplate;d&&(T(e,Tt.bn,d.getUrl),d.size&&T(e,Tt.un,d.size.toString()),d.eTag&&T(e,Tt.on,d.eTag),d.uniqueId&&T(e,Tt.nn,d.uniqueId)),t.user.id&&T(e,Tt.yn,t.user.id),t.ownerId&&T(e,Tt.gn,t.ownerId),t.sessionContext&&T(e,Tt.In,t.sessionContext);var l=t.ui;return l&&l.controls&&T(e,Tt.wn,JSON.stringify(l.controls)),e}(t);return Object.keys(e).forEach((function(t){e[t]?i[t]=e[t]:delete i[t]})),i}var Ge=[],qe=function(t,e,i,o,s){return new Promise((function(t){var a,c=J();Be(e,i.skipWopiValidation),i.state=k.Booting,i.pendingReboot=!1,ot(i.logger,!0);var u,f=!1,d=function(t,e){var s,a;f||(i.container.postMessage(gt.si,void 0),s=i.appInitDiagnostics,(a=e.Diagnostics)&&Object.keys(a).forEach((function(t){s[t]=a[t]}))),o.onBootSuccess&&o.onBootSuccess(i),i.logger.ULS.u(596448985,r.N,n.Info,JSON.stringify(i.diagnostics)),i.logger.ULS.flush(),i.container.postMessage(gt.pi,{HostInitializeDiagnostics:i.hostInitDiagnostics}),i.state=k.Booted;var c={completion:"success"};i.raiseEvent(It.BootCompleted,c),p(c),tt(i.appInfo.name,i.logger)},l=function(t,e){i.logger.ULS.u(596448986,r.N,n.Error,JSON.stringify({error:e.Error,diagnostics:i.diagnostics})),i.logger.ULS.flush(),i.state=k.Failed;var o={completion:"failure"};i.raiseEvent(It.BootCompleted,o),p(o),tt(i.appInfo.name,i.logger)},p=function(e){f||(ut(),dt(Ge),Ge=[],i.removeActionHandler(wt.se,d),i.removeActionHandler(wt.oe,l)),t(e)};if((s||new Me(3e5)).subscribe((function(){p({completion:"cancelled"})})),i.appBaseUrl=e.appBaseUrl?e.appBaseUrl.toLowerCase():y(e.appUrl).toLowerCase(),i.appUrl=e.appUrl||"",i.bootParams=e.bootParams||{},i.appUrl&&N(i.appUrl)&&(i.bootParams.isNewFile=!0),i.rebootOverride=e.rebootOverride,i.appBasePath=o.buildAppBasePath(i),i.intent=e.intent,i.file=e.file,i.wopi=e.wopi,i.contentBundle=e.contentBundle,i.newFileTemplate=e.newFileTemplate,i.ownerId=e.ownerId,i.sessionContext=e.sessionContext,i.actNavId=e.actNavId,i.preseededSession=e.preseededSession,i.throttling=e.throttling,i.hostInitDiagnostics=h(h({},e.diagnostics),{hostInitializeCallTime:c}),i.wdParams=e.wdParams||{},window.location.search.substring(1).split("&").forEach((function(t){if(/^wd\w+=\w+/.test(t)){var e=t.split("=");i.wdParams[e[0]]=e[1]}})),e.rebootOverride&&(a=Ot(),i.sessionId=a[0],u=a[1],i.Et.addSettingsChangeListener(i.logger.settingsChangeHandler)),i.logger.configure({remoteUlsEndpoint:_(i.appBasePath),sessionId:i.sessionId}),i.Et.initializePeriodicFetch(i.appBasePath,i.sessionId),u&&i.logger.ULS.u(590966790,r.N,n.Info,JSON.stringify(u)),function(t){try{var e=t.hostInitDiagnostics;t.logger.ULS.u(590447446,r.N,n.Info,"HostInitDiagnostics: "+(e?JSON.stringify(e):"N/A")),t.logger.ULS.u(596444237,r.N,n.Info,JSON.stringify({session:et(t),client:it()}))}catch(e){t.logger.ULS.u(590447447,r.N,n.Error,"Failed to log init info: "+Y(e))}}(i),i.appInitDiagnostics={officeSessionId:i.sessionId,officeBootstrapperVersion:Z(),hostName:i.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(function(){i.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!i.container){var v=e.container;i.container=v instanceof xt?v:i.application.createContainer(v)}i.container.setMessageHandler(i.onMessage),(f=!!o.ignoreCompletionMessage&&o.ignoreCompletionMessage(i))||(i.addActionHandler(wt.se,d),i.addActionHandler(wt.oe,l));var m=o.buildBootRequestParams(i),w=Ve(i,m.appPageName,m.queryParamsOverrides);if(i.bootstrapperUrl&&i.preloader&&i.preloader.shouldPreload(w))try{o.beforePreload&&o.beforePreload(i);var g=i.bootstrapperUrl;i.featureManager.isFeatureEnabled(ft.Wt)&&(i.logger.ULS.u(590966791,r.N,n.Info,"HTTP2 preload enabled"),g=R(g));var I=void 0;i.ui&&(I=i.ui.language),I||(I=decodeURIComponent(A(w,"ui"))),i.preloader.preload(g,I,i.logger,i.featureManager)}catch(t){i.logger.ULS.u(590966792,r.N,n.Error,Y(t))}var b=ze(i,m.postDataOverrides);o.beforeContainerBoot&&o.beforeContainerBoot(i,w),i.appInitDiagnostics.officeFrameCreateTime=J(),i.container.boot(w,b,i.logger),f?d(wt.se,{Diagnostics:{}}):(ct(S(i.appBaseUrl),i.Et,i.logger,(function(){return ht(i.logger)})),Ge.push(window.setTimeout((function(){return ht(i.logger,1)}),i.Et.getValue(j.gt,6e4))),Ge.push(window.setTimeout((function(){return ht(i.logger,2)}),i.Et.getValue(j.It,18e4))))}))},Ze=function(t,e,i,o,s){return new Promise((function(t){i.logger.ULS.u(579342435,r.N,n.Info,"Received close tab message");try{window.close()}catch(t){i.logger.ULS.u(579213189,r.N,n.Warning,"Failed to close the browser tab")}t({completion:"success"})}))},$e=function(t,e,i,o,s){return new Promise((function(t){var e=i.host.requireExplicitUnload,o={disposeStartTime:J(),forceAppUnload:e};i.state=k.Disposing;var a=function(){var e={completion:"success"};i.raiseEvent(It.Disposed,e),i.state=k.Disposed,t(e)},c=function(t){i.dispose(),o.disposeEndTime=J(),function(t,e,i){if(i){var o=Number(i.hostMessageReceived);e.appUnloadStartTime&&!isNaN(o)&&(e.hostToAppPostMessageLatency=o-e.appUnloadStartTime);var s=Number(i.appMessageSent);!isNaN(s)&&e.appUnloadEndTime&&(e.appToHostPostMessageLatency=e.appUnloadEndTime-s);var a=Number(i.appUnloadStart),c=Number(i.appUnloadEnd);if(isNaN(a)||isNaN(c)||(e.appUnloadLatency=c-a),i.serverTimings){var u=i.serverTimings;for(var f in u)e["st-"+f.toString()]=u[f]}}t.logger.ULS.u(592524822,r.N,n.Info,"App disposed: "+JSON.stringify(e)),t.logger.ULS.flushOnClose()}(i,o,t),rt(),i.container?i.container.dispose(i.pendingReboot,e).then(a):a()};if(e){o.appUnloadStartTime=J();i.addActionHandler(wt.qe,(function(t,e){o.appUnloadEndTime=J(),c(e)})),(s||new Me(5e3)).subscribe((function(){i.state===k.Disposing&&(o.appUnloadTimedOut=!0,c())})),i.container&&i.container.postMessage(gt.xi,void 0)}else c()}))};var Xe=function(t,e,i,o,s){return new Promise((function(t){var e=!!i.container&&i.container.isTopFrameTrusted;i.logger.ULS.u(592445957,r.N,n.Info,"Top frame is trusted: "+e),i.container&&i.container.postMessage(gt.Oe,{isTopFrameTrusted:e}),t({completion:"success"})}))},Ke=function(t,e,i,o,s){return new Promise((function(t){var s=e&&e.state?e.state:"Unknown";i.logger.ULS.u(592839750,r.N,n.Info,"Boot state: ["+s+"]"),o&&o.beforeComplete&&o.beforeComplete(s),t({completion:"success"})}))},Qe=function(t,e,i,n,o){return new Promise((function(t){var n=function(t,i){var n={completion:i.NewName===e.NewName?"success":"failure"};s(n)},r=function(t,e){s({completion:"failure"})},s=function(e){i.removeActionHandler(wt.Se,n),i.removeActionHandler(wt.be,r),t(e)};i.addActionHandler(wt.Se,n),i.addActionHandler(wt.be,r),(o||new Me(5e3)).subscribe((function(){s({completion:"cancelled"})})),i.container&&i.container.postMessage(gt.gi,e)}))},Ye=function(t,e,i,n,o){return new Promise((function(t){var n=function(t,e){r({completion:"success"})},r=function(e){i.removeActionHandler(wt.Ue,n),t(e)};i.addActionHandler(wt.Ue,n),(o||new Me(5e3)).subscribe((function(){r({completion:"cancelled"})})),i.container&&i.container.postMessage(gt.Ni,e)}))};function ti(t){Ce(t.logger)}function ei(t){var e=t.appUrl.toLowerCase().indexOf("_layouts/xlembed.aspx")>-1?"_layouts/xlembed.aspx":Pe,i={},n={};T(i,"wdredirectionreason","Force_SingleStepBoot");var o=t.bootParams;o&&o.isNewFile?(i["unified".toLowerCase()]="",T(i,"edit","1"),T(i,"new","1")):T(i,"instantedit","1"),t.hostInitDiagnostics&&T(n,Tt.vn,JSON.stringify({HostInitializeDiagnostics:t.hostInitDiagnostics}));var r=t.rebootOverride;if(r){var s=r.mode;s&&("view"===(s=s.toLowerCase())?T(i,"wdforcedmode","View"):"edit"===s&&T(i,"wdforcedmode","Edit"))}return{appPageName:e,queryParamsOverrides:i,postDataOverrides:n}}function ii(t,e){re(e)&&ie(t.logger,t.container.formId,t.featureManager,t.sessionId)}var ni,oi=function(t){return t.isFeatureEnabled(ft.Nt)||t.isFeatureEnabled(ft.Dt)?[(e={},e[vt.accessToken]=ke,e[vt.appReboot]=xe,e[vt.authToken]=ke,e[vt.boot]=qe,e[vt.closeTab]=Ze,e[vt.createNew]=Fe,e[vt.customAuthConfig]=ke,e[vt.dispose]=$e,e[vt.fileEmbed]=ke,e[vt.frameTrust]=Xe,e[vt.handleBootState]=Ke,e[vt.postMessage]=Fe,e[vt.refreshSessionInfo]=ke,e[vt.rename]=Qe,e[vt.setOverlayContent]=Lt,e[vt.switchMode]=Ye,e[vt.userAccessAndPermissions]=ke,e[vt.wopiInfoFromUrl]=ke,e),(i={},i[vt.boot]={beforePreload:ti,buildAppBasePath:Le,buildBootRequestParams:ei,beforeContainerBoot:ii,onBootSuccess:oe},i[vt.handleBootState]={beforeComplete:ne},i)]:je();var e,i};!function(t){t[t.NotSupported=0]="NotSupported",t[t.SameDocOnly=1]="SameDocOnly",t[t.AnyDoc=2]="AnyDoc",t[t.OtherMode=4]="OtherMode"}(ni||(ni={})),i.d(e,"Application",(function(){return ri})),i.d(e,"createApplication",(function(){return si})),i.d(e,"DocRebootSupportMode",(function(){return ni})),i.d(e,"CommandIds",(function(){return mt})),i.d(e,"EventIds",(function(){return It})),i.d(e,"createCancellationToken",(function(){return De}));var ri=new Oe((function(t,e,i,n,o){return new Ee(t,e,i,n,o)}),{forceSingleStepBoot:!0,preloader:x(Ue,Re)}),si=function(t){var e={name:"Excel",preloader:x(Ue,Re)};return new Ft(t,e,oi)}}});

